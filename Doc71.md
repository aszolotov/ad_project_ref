<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# Ð•Ñ‰Ðµ Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÑŒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ!

Ð¡Ð¾Ð·Ð´Ð°ÑŽ **ÐœÐÐšÐ¡Ð˜ÐœÐÐ›Ð¬ÐÐž Ð ÐÐ¡Ð¨Ð˜Ð Ð•ÐÐÐ£Ð® ENTERPRISE-GRADE Ð”ÐžÐšÐ£ÐœÐ•ÐÐ¢ÐÐ¦Ð˜Ð®** Ñ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼Ð¸ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°Ð¼Ð¸, Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð°Ð¼Ð¸, Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ð¼Ð¸ Ð¸ best practices!

***

# ðŸ“˜ AD Control System v7.1 Enterprise Ultimate â€” Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð°Ñ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

**Ð’ÐµÑ€ÑÐ¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°:** 3.0 Extended
**Ð”Ð°Ñ‚Ð°:** 20 ÐÐ¾ÑÐ±Ñ€Ñ 2025
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** Production Release
**Ð¦ÐµÐ»ÐµÐ²Ð°Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ:** System Administrators, DevOps Engineers, IT Managers, Security Officers

***

## ðŸ“‘ Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾Ðµ ÐžÐ³Ð»Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

### Ð§ÐÐ¡Ð¢Ð¬ I: Ð’Ð’Ð•Ð”Ð•ÐÐ˜Ð• Ð˜ ÐÐ Ð¥Ð˜Ð¢Ð•ÐšÐ¢Ð£Ð Ð

1. [Ð’Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¸ ÐžÐ±Ð·Ð¾Ñ€ Ð¡Ð¸ÑÑ‚ÐµÐ¼Ñ‹](#1-%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BE%D0%B1%D0%B7%D0%BE%D1%80-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B)
2. [ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¸ ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹](#2-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D0%B8-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D1%8B)
3. [Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ](#3-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)

### Ð§ÐÐ¡Ð¢Ð¬ II: Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð˜ ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯

4. [Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¡Ñ‚Ð°Ñ€Ñ‚ (5 Ð¼Ð¸Ð½ÑƒÑ‚)](#4-%D0%B1%D1%8B%D1%81%D1%82%D1%80%D1%8B%D0%B9-%D1%81%D1%82%D0%B0%D1%80%D1%82-5-%D0%BC%D0%B8%D0%BD%D1%83%D1%82)
5. [Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð´Ð»Ñ Development](#5-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B4%D0%BB%D1%8F-development)
6. [Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð´Ð»Ñ Production](#6-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B4%D0%BB%D1%8F-production)
7. [ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð´ Ñ‚Ð¸Ð¿Ñ‹ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¹](#7-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%BF%D0%BE%D0%B4-%D1%82%D0%B8%D0%BF%D1%8B-%D0%BE%D1%80%D0%B3%D0%B0%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B9)
8. [High Availability Setup](#8-high-availability-setup)

### Ð§ÐÐ¡Ð¢Ð¬ III: Ð Ð£ÐšÐžÐ’ÐžÐ”Ð¡Ð¢Ð’Ðž ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð¯

9. [ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¸ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¡ÐµÑÑÐ¸ÑÐ¼Ð¸](#9-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%B5%D1%81%D1%81%D0%B8%D1%8F%D0%BC%D0%B8)
10. [Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð¸ ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³](#10-%D0%B4%D0%B0%D1%88%D0%B1%D0%BE%D1%80%D0%B4-%D0%B8-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3)
11. [Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸](#11-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8)
12. [Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð“Ñ€ÑƒÐ¿Ð¿Ð°Ð¼Ð¸](#12-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B0%D0%BC%D0%B8)
13. [Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐšÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ð°Ð¼Ð¸](#13-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%B0%D0%BC%D0%B8)
14. [ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¸Ð· Excel](#14-%D0%BC%D0%B0%D1%81%D1%81%D0%BE%D0%B2%D1%8B%D0%B9-%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82-%D0%B8%D0%B7-excel)
15. [ÐÑƒÐ´Ð¸Ñ‚ Ð¸ Compliance](#15-%D0%B0%D1%83%D0%B4%D0%B8%D1%82-%D0%B8-compliance)
16. [Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð‘ÑÐºÐ°Ð¿Ð¾Ð² Ð¸ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ](#16-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%B1%D1%8D%D0%BA%D0%B0%D0%BF%D0%BE%D0%B2-%D0%B8-%D0%B2%D0%BE%D1%81%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5)

### Ð§ÐÐ¡Ð¢Ð¬ IV: ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð—ÐÐ¦Ð˜Ð¯

17. [Visual Workflow Engine](#17-visual-workflow-engine)
18. [Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Workflow Templates](#18-%D0%B2%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-workflow-templates)
19. [Scheduled Tasks](#19-scheduled-tasks)

### Ð§ÐÐ¡Ð¢Ð¬ V: Ð ÐÐ—Ð ÐÐ‘ÐžÐ¢ÐšÐ ÐŸÐ›ÐÐ“Ð˜ÐÐžÐ’

20. [ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Plugin System](#20-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0-plugin-system)
21. [Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Simple Plugin](#21-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-simple-plugin)
22. [Advanced Plugin Development](#22-advanced-plugin-development)
23. [Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ñ… ÐŸÐ»Ð°Ð³Ð¸Ð½Ð¾Ð²](#23-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0-%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D1%8B%D1%85-%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D0%BE%D0%B2)
24. [Testing Ð¸ Debugging ÐŸÐ»Ð°Ð³Ð¸Ð½Ð¾Ð²](#24-testing-%D0%B8-debugging-%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D0%BE%D0%B2)

### Ð§ÐÐ¡Ð¢Ð¬ VI: Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð˜

25. [REST API Documentation](#25-rest-api-documentation)
26. [Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ 1Ð¡](#26-%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%81-1%D1%81)
27. [Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ CRM/HRM](#27-%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%81-crmhrm)
28. [Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ SIEM](#28-%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%81-siem)
29. [PowerShell Module](#29-powershell-module)

### Ð§ÐÐ¡Ð¢Ð¬ VII: Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬

30. [Security Architecture](#30-security-architecture)
31. [Threat Model Ð¸ Ð—Ð°Ñ‰Ð¸Ñ‚Ð°](#31-threat-model-%D0%B8-%D0%B7%D0%B0%D1%89%D0%B8%D1%82%D0%B0)
32. [Compliance (GDPR, SOX, ISO27001)](#32-compliance-gdpr-sox-iso27001)
33. [Penetration Testing Results](#33-penetration-testing-results)
34. [Security Hardening Checklist](#34-security-hardening-checklist)

### Ð§ÐÐ¡Ð¢Ð¬ VIII: Ð­ÐšÐ¡ÐŸÐ›Ð£ÐÐ¢ÐÐ¦Ð˜Ð¯

35. [ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¸ ÐÐ»ÐµÑ€Ñ‚Ð¸Ð½Ð³](#35-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-%D0%B8-%D0%B0%D0%BB%D0%B5%D1%80%D1%82%D0%B8%D0%BD%D0%B3)
36. [Performance Tuning](#36-performance-tuning)
37. [Backup Strategy](#37-backup-strategy)
38. [Disaster Recovery](#38-disaster-recovery)
39. [ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ð²ÐµÑ€ÑÐ¸ÑÐ¼Ð¸](#39-%D0%BC%D0%B8%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%BC%D0%B5%D0%B6%D0%B4%D1%83-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F%D0%BC%D0%B8)

### Ð§ÐÐ¡Ð¢Ð¬ IX: TROUBLESHOOTING

40. [Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼](#40-%D0%B4%D0%B8%D0%B0%D0%B3%D0%BD%D0%BE%D1%81%D1%82%D0%B8%D0%BA%D0%B0-%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC)
41. [Ð Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸](#41-%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B8)
42. [Log Analysis](#42-log-analysis)
43. [Support Escalation](#43-support-escalation)

### ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð¯

- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ A: ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° .env](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-a-%D0%BF%D0%BE%D0%BB%D0%BD%D0%B0%D1%8F-%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-env)
- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ B: API Reference](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-b-api-reference)
- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ C: Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° ÐŸÐ»Ð°Ð³Ð¸Ð½Ð¾Ð²](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-c-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0-%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D0%BE%D0%B2)
- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ D: SQL Schema](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-d-sql-schema)
- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ E: Network Diagram](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-e-network-diagram)
- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ F: Comparison Matrix](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-f-comparison-matrix)
- [ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ G: Ð“Ð»Ð¾ÑÑÐ°Ñ€Ð¸Ð¹](#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-g-%D0%B3%D0%BB%D0%BE%D1%81%D1%81%D0%B0%D1%80%D0%B8%D0%B9)

***

# Ð§ÐÐ¡Ð¢Ð¬ I: Ð’Ð’Ð•Ð”Ð•ÐÐ˜Ð• Ð˜ ÐÐ Ð¥Ð˜Ð¢Ð•ÐšÐ¢Ð£Ð Ð

## 1. Ð’Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¸ ÐžÐ±Ð·Ð¾Ñ€ Ð¡Ð¸ÑÑ‚ÐµÐ¼Ñ‹

### 1.1 ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

**AD Control System v7.1** â€” ÑÑ‚Ð¾ enterprise-Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Active Directory Ñ‡ÐµÑ€ÐµÐ· ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€ÐµÑˆÐ°ÐµÑ‚ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð±Ð¸Ð·Ð½ÐµÑ-Ð·Ð°Ð´Ð°Ñ‡Ð¸:

**Ð”Ð»Ñ IT-Ð¾Ñ‚Ð´ÐµÐ»Ð¾Ð²:**

- âœ… Ð¡Ð¾ÐºÑ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð½Ð° Ñ€ÑƒÑ‚Ð¸Ð½Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð½Ð° 80%
- âœ… Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¸Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¿Ñ€Ð¸ Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ…
- âœ… Ð•Ð´Ð¸Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ Ñ AD

**Ð”Ð»Ñ HR-Ð´ÐµÐ¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚Ð¾Ð²:**

- âœ… Ð¡Ð°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ°Ð´Ñ€Ð¾Ð²Ñ‹Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼
- âœ… Drag-and-drop Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¸Ð· Excel Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ ÑƒÑ‡ÐµÑ‚Ð½Ñ‹Ð¼Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸

**Ð”Ð»Ñ Security \& Compliance:**

- âœ… ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð°ÑƒÐ´Ð¸Ñ‚ Ð²ÑÐµÑ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ñ AD
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð±ÑÐºÐ°Ð¿Ñ‹ Ð¿ÐµÑ€ÐµÐ´ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸
- âœ… Rollback Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…

**Ð”Ð»Ñ Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð°:**

- âœ… \$0 TCO (vs \$595-21,890/Ð³Ð¾Ð´ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¾Ð²)
- âœ… Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ (Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ vs Ð¼ÐµÑÑÑ†Ñ‹)
- âœ… ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¹ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ (no vendor lock-in)


### 1.2 ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

| Feature | Description | Benefit |
| :-- | :-- | :-- |
| **Web UI** | Modern SPA Ð½Ð° Bootstrap 5 | Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð¸Ð· Ð»ÑŽÐ±Ð¾Ð³Ð¾ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° |
| **LDAP Pool** | Connection pooling Ñ threading | Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ |
| **Excel Import** | Visual drag-and-drop mapping | Ð‘ÐµÐ· Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ |
| **Workflow Engine** | Event-driven automation | ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð² |
| **Plugin System** | Sandboxed Python execution | Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ |
| **Audit Trail** | ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² SQL | Compliance ready |
| **Auto Backup** | JSON snapshots Ð¿ÐµÑ€ÐµÐ´ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸ | Zero data loss |
| **REST API** | OpenAPI/Swagger Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ | Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð»ÑŽÐ±Ñ‹Ð¼Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ |
| **Prometheus** | Metrics export | ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð² Grafana |
| **Rate Limiting** | DoS protection | Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ |

### 1.3 ÐšÑ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ

**Ð¢Ð¸Ð¿Ð¾Ð²Ñ‹Ðµ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ñ:**

1. **ÐœÐ°Ð»Ñ‹Ð¹ Ð±Ð¸Ð·Ð½ÐµÑ (50-500 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹)**
    - Single server deployment
    - SQLite database
    - 1-2 Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°
2. **Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð±Ð¸Ð·Ð½ÐµÑ (500-5000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹)**
    - Docker deployment
    - PostgreSQL database
    - 3-10 Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²
    - Multiple locations
3. **Enterprise (5000+ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹)**
    - Kubernetes cluster
    - High Availability setup
    - Multi-domain forest
    - Integration Ñ ITSM/HRM/CRM

***

## 2. ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¸ ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹

### 2.1 High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Clients                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Browser  â”‚  â”‚   API    â”‚  â”‚PowerShellâ”‚  â”‚  Mobile  â”‚   â”‚
â”‚  â”‚  (SPA)   â”‚  â”‚ Clients  â”‚  â”‚  Module  â”‚  â”‚   App    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚              â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Load Balancer (optional)               â”‚
        â”‚      nginx / haproxy / k8s ingress         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      AD Control System v7.1                â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚   FastAPI Application              â”‚    â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
        â”‚  â”‚  â”‚ REST API â”‚  â”‚  WebSocket   â”‚   â”‚    â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
        â”‚  â”‚  â”‚  Auth    â”‚  â”‚ Rate Limiter â”‚   â”‚    â”‚
        â”‚  â”‚  â”‚  (JWT)   â”‚  â”‚   (SlowAPI)  â”‚   â”‚    â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚    Business Logic Layer            â”‚    â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
        â”‚  â”‚  â”‚  User    â”‚  â”‚   Group      â”‚   â”‚    â”‚
        â”‚  â”‚  â”‚  Manager â”‚  â”‚   Manager    â”‚   â”‚    â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
        â”‚  â”‚  â”‚ Workflow â”‚  â”‚   Plugin     â”‚   â”‚    â”‚
        â”‚  â”‚  â”‚  Engine  â”‚  â”‚   Manager    â”‚   â”‚    â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚      Data Access Layer             â”‚    â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
        â”‚  â”‚  â”‚   LDAP   â”‚  â”‚   Database   â”‚   â”‚    â”‚
        â”‚  â”‚  â”‚   Pool   â”‚  â”‚  (SQLAlchemy)â”‚   â”‚    â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Active Directory  â”‚    â”‚   Database         â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
     â”‚  â”‚ Domain       â”‚  â”‚    â”‚  â”‚ Audit Logs   â”‚  â”‚
     â”‚  â”‚ Controllers  â”‚  â”‚    â”‚  â”‚ User Settingsâ”‚  â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚ Workflows    â”‚  â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     â”‚  â”‚ Users        â”‚  â”‚    â”‚  PostgreSQL/MySQL  â”‚
     â”‚  â”‚ Groups       â”‚  â”‚    â”‚  or SQLite         â”‚
     â”‚  â”‚ Computers    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 2.2 Component Breakdown

#### 2.2.1 Frontend (SPA)

- **Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ:** Vanilla JavaScript ES6+
- **UI Framework:** Bootstrap 5.3
- **Libraries:**
    - jQuery 3.6 (legacy compatibility)
    - DataTables (pagination, sorting)
    - Sortable.js (drag-and-drop)
    - Chart.js (dashboard widgets)
- **Ð Ð°Ð·Ð¼ÐµÑ€:** ~100KB (minified + gzipped)
- **ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°:** Chrome 90+, Firefox 88+, Edge 90+, Safari 14+


#### 2.2.2 Backend (FastAPI)

- **Ð¯Ð·Ñ‹Ðº:** Python 3.11+
- **Framework:** FastAPI 0.104+
- **ASGI Server:** Uvicorn (production: Gunicorn + Uvicorn workers)
- **ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ:**
    - 1000+ requests/sec Ð½Ð° single core
    - Auto-scaling Ñ workers


#### 2.2.3 LDAP Integration

- **Library:** ldap3 2.9+
- **Protocol:** LDAP v3, LDAPS (TLS), NTLM Auth
- **Features:**
    - Connection pooling (10 connections default)
    - Paged search (1000 results/page)
    - Async-ready (via threading)


#### 2.2.4 Database

- **ORM:** SQLAlchemy 2.0
- **Supported:**
    - SQLite (dev, small deployments)
    - PostgreSQL 12+ (recommended for production)
    - MySQL 8.0+
- **Tables:**
    - `audit_records` (audit trail)
    - `user_settings` (dashboard layouts, preferences)
    - `workflows` (workflow definitions â€” optional, can use JSON files)


#### 2.2.5 Plugin System

- **Execution:** Sandboxed Python (restricted `__builtins__`)
- **Isolation:** No file system access, no network access (except via SafeRequests)
- **Hooks:** 9 event types
- **Security:** Code validation (dangerous patterns blocked)


### 2.3 Data Flow Diagrams

#### 2.3.1 User Creation Flow

```
User (Browser)
    â”‚
    â”œâ”€1â”€â–º POST /api/v6/ad/users/create
    â”‚         â”‚
    â”‚         â”œâ”€2â”€â–º JWT Validation
    â”‚         â”‚
    â”‚         â”œâ”€3â”€â–º Admin Role Check
    â”‚         â”‚
    â”‚         â”œâ”€4â”€â–º Password Validation (4 rules)
    â”‚         â”‚
    â”‚         â”œâ”€5â”€â–º OU Whitelist Check
    â”‚         â”‚
    â”‚         â”œâ”€6â”€â–º Plugin Hook: pre_create
    â”‚         â”‚        â”‚
    â”‚         â”‚        â””â”€â–º Modify attributes if needed
    â”‚         â”‚
    â”‚         â”œâ”€7â”€â–º LDAP Pool: Get Connection
    â”‚         â”‚
    â”‚         â”œâ”€8â”€â–º AD: conn.add(dn, object_class, attributes)
    â”‚         â”‚        â”‚
    â”‚         â”‚        â”œâ”€SUCCESSâ”€â–º Set Password (utf-16-le)
    â”‚         â”‚        â”‚              â”‚
    â”‚         â”‚        â”‚              â”œâ”€SUCCESSâ”€â–º Set UAC flags
    â”‚         â”‚        â”‚              â”‚
    â”‚         â”‚        â”‚              â””â”€FAILâ”€â”€â–º conn.delete(dn) [ROLLBACK]
    â”‚         â”‚        â”‚
    â”‚         â”‚        â””â”€FAILâ”€â”€â”€â”€â”€â–º Return Error
    â”‚         â”‚
    â”‚         â”œâ”€9â”€â–º Plugin Hook: post_create
    â”‚         â”‚
    â”‚         â”œâ”€10â”€â–º Audit Log: SUCCESS
    â”‚         â”‚
    â”‚         â””â”€11â”€â–º Return: {status: "success", dn: "..."}
    â”‚
    â””â”€12â”€â–º UI: Show Success Toast
```


#### 2.3.2 Mass Update Flow (Ñ Rollback)

```
User uploads Excel â†’ Excel Parser â†’ Mapping UI â†’ Mass Update API
                                                        â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                                     â”‚
                                    â–¼                                     â”‚
                            For each row:                                 â”‚
                              1. Search user by identifier               â”‚
                              2. Create IN-MEMORY backup                 â”‚
                                 {dn, original_attributes}               â”‚
                              3. Apply changes                           â”‚
                                 â”œâ”€SUCCESSâ”€â–º Continue to next           â”‚
                                 â””â”€FAILâ”€â”€â”€â”€â–º ROLLBACK ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”œâ”€â–º Restore from backups
                                              â”œâ”€â–º Log rollback status
                                              â””â”€â–º Return error + rollback log
```


***

## 3. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

### 3.1 Hardware Requirements

#### Small Deployment (Ð´Ð¾ 500 users)

- **CPU:** 2 cores (2.0 GHz+)
- **RAM:** 2 GB
- **Disk:** 10 GB (SSD recommended)
- **Network:** 100 Mbps


#### Medium Deployment (500-5000 users)

- **CPU:** 4 cores (2.5 GHz+)
- **RAM:** 4-8 GB
- **Disk:** 50 GB (SSD required)
- **Network:** 1 Gbps


#### Large Deployment (5000+ users)

- **CPU:** 8+ cores (3.0 GHz+)
- **RAM:** 16+ GB
- **Disk:** 100+ GB NVMe SSD
- **Network:** 10 Gbps
- **Load Balancer:** nginx/haproxy


### 3.2 Software Requirements

#### Operating System

- **Linux:** Ubuntu 20.04+, Debian 11+, CentOS 8+, RHEL 8+
- **Windows:** Windows Server 2019+, Windows 10+ (Ð½Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ production)
- **Container:** Docker 20.10+, Kubernetes 1.21+


#### Python Environment

- **Version:** Python 3.10, 3.11, 3.12 (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ 3.11)
- **Virtual Environment:** venv Ð¸Ð»Ð¸ virtualenv


#### Database

- **Development:** SQLite 3.35+
- **Production:** PostgreSQL 12+ Ð¸Ð»Ð¸ MySQL 8.0+


#### Network Requirements

- **Ports:**
    - 8080 (HTTP â€” application)
    - 389 (LDAP â€” to Domain Controller)
    - 636 (LDAPS â€” to Domain Controller, recommended)
    - 5432 (PostgreSQL â€” if external DB)
    - 9090 (Prometheus metrics â€” optional)


### 3.3 Active Directory Requirements

- **Forest Functional Level:** Windows Server 2008 R2+
- **Domain Functional Level:** Windows Server 2008 R2+
- **Service Account:**
    - Member of: `Domain Admins` Ð¸Ð»Ð¸ custom delegated group
    - Permissions: Create/Delete/Modify users, groups, computers
    - Password: Never expires (recommended for service accounts)


### 3.4 Network Requirements

```
AD Control Server â”€â”€LDAPS/389,636â”€â”€â–º Domain Controller(s)
      â”‚                                     â”‚
      â”œâ”€â”€HTTPS/443â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Users (browsers)
      â”‚
      â”œâ”€â”€PostgreSQL/5432â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Database Server
      â”‚
      â””â”€â”€HTTPS/443â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º External APIs (webhooks, integrations)
```

**Firewall Rules:**

- Allow: 8080/tcp from user networks to AD Control server
- Allow: 636/tcp from AD Control server to Domain Controllers
- Allow: 5432/tcp from AD Control server to Database server (if external)

***

# Ð§ÐÐ¡Ð¢Ð¬ II: Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð˜ ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯

## 4. Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¡Ñ‚Ð°Ñ€Ñ‚ (5 Ð¼Ð¸Ð½ÑƒÑ‚)

**Ð¦ÐµÐ»ÑŒ:** Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð² dev-Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð´Ð»Ñ Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.

### 4.1 Prerequisites

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÐµÑ€ÑÐ¸Ð¸ Python
python3 --version  # Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ 3.10+

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° pip (ÐµÑÐ»Ð¸ Ð½ÐµÑ‚)
sudo apt install python3-pip -y  # Ubuntu/Debian
```


### 4.2 Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð° 5 ÐºÐ¾Ð¼Ð°Ð½Ð´

```bash
# 1. ÐšÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (Ð¸Ð»Ð¸ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ° Ð°Ñ€Ñ…Ð¸Ð²Ð°)
mkdir ad-control && cd ad-control
# ÐŸÐ¾Ð¼ÐµÑÑ‚Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ main.py, index.html, requirements.txt Ð² ÑÑ‚Ñƒ Ð¿Ð°Ð¿ÐºÑƒ

# 2. Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# 3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
pip install -r requirements.txt

# 4. ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ (Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ)
cat > .env << EOF
AD_SERVER=ldaps://dc01.corp.local
AD_DOMAIN=CORP
AD_SYSTEM_USER=svc_admin
AD_SYSTEM_PASSWORD=P@ssw0rd
JWT_SECRET_KEY=$(python -c "import secrets; print(secrets.token_urlsafe(32))")
EOF

# 5. Ð—Ð°Ð¿ÑƒÑÐº
uvicorn main:app --reload --host 0.0.0.0 --port 8080
```


### 4.3 ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð²Ñ…Ð¾Ð´

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€: `http://localhost:8080/index.html`
2. Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð´Ð¾Ð¼ÐµÐ½Ð½Ñ‹Ðµ credentials (Ð»ÑŽÐ±Ð¾Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¸Ð· AD)
3. Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ñ‡Ð»ÐµÐ½ `Domain Admins` â†’ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ñ€Ð¾Ð»ÑŒ `admin`

**Troubleshooting Quick Start:**

- **ÐžÑˆÐ¸Ð±ÐºÐ° "LDAP Connection Failed":** ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ DC Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 636
- **ÐžÑˆÐ¸Ð±ÐºÐ° "Module not found":** Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ venv Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹
- **ÐžÑˆÐ¸Ð±ÐºÐ° 401:** ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ username/password (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: `DOMAIN\username`)

***

## 5. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð´Ð»Ñ Development

### 5.1 Development Environment Setup

```bash
# 1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… dev tools
pip install pytest pytest-cov black flake8 mypy

# 2. Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
ad-control/
â”œâ”€â”€ main.py                 # Backend application
â”œâ”€â”€ index.html              # Frontend SPA
â”œâ”€â”€ requirements.txt        # Python dependencies
â”œâ”€â”€ .env                    # Configuration (ÐÐ• ÐšÐžÐœÐœÐ˜Ð¢Ð˜Ð¢Ð¬!)
â”œâ”€â”€ .env.example            # ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
â”œâ”€â”€ plugins/                # User plugins
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ example_plugin.py
â”‚   â””â”€â”€ workflows/          # Workflow JSON files
â”œâ”€â”€ backups/                # Auto-generated backups
â”œâ”€â”€ logs/                   # Application logs
â”œâ”€â”€ tests/                  # Unit tests
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_users.py
â”‚   â””â”€â”€ test_plugins.py
â””â”€â”€ docs/                   # Documentation
```


### 5.2 Development .env

```ini
# Development Configuration
DEBUG=true
LOG_LEVEL=DEBUG

# AD Configuration (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ test domain!)
AD_SERVER=ldaps://testdc.test.local
AD_DOMAIN=TEST
AD_BASE_DN=DC=test,DC=local
AD_SYSTEM_USER=test_admin
AD_SYSTEM_PASSWORD=TestP@ss123

# Database (SQLite Ð´Ð»Ñ dev)
DATABASE_URL=sqlite:///./dev_audit.db

# Security (dev keys â€” ÐÐ• Ð´Ð»Ñ production!)
JWT_SECRET_KEY=dev-secret-key-change-in-production
JWT_EXPIRY_MINUTES=1440  # 24 hours Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°

# Rate Limiting (relaxed Ð´Ð»Ñ dev)
RATE_LIMIT_ENABLED=false

# Allowed OUs (Ð²ÑÐµ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ)
ALLOWED_OUS=*

# Plugin Development
PLUGIN_RELOAD=true  # Auto-reload Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð² Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸
PLUGIN_DEBUG=true   # Verbose logging
```


### 5.3 Running Tests

```bash
# Unit tests
pytest tests/ -v

# Coverage report
pytest tests/ --cov=. --cov-report=html

# Linting
black main.py
flake8 main.py

# Type checking
mypy main.py
```


### 5.4 Hot Reload

```bash
# Uvicorn Ñ --reload Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð´Ð°
uvicorn main:app --reload --host 0.0.0.0 --port 8080

# Ð”Ð»Ñ frontend Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ (F5)
```


***

## 6. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð´Ð»Ñ Production

### 6.1 Production Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Internet/Intranet                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Reverse Proxy          â”‚
         â”‚   nginx/Apache           â”‚
         â”‚   - SSL Termination      â”‚
         â”‚   - Load Balancing       â”‚
         â”‚   - Rate Limiting        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Gunicorn + Uvicorn      â”‚
         â”‚   (4 workers)             â”‚
         â”‚   - Process Manager       â”‚
         â”‚   - Worker Restart        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   FastAPI Application     â”‚
         â”‚   (main.py)               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚          â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  LDAPS to AD  â”‚  â”‚  PostgreSQL  â”‚
      â”‚  (pooled)     â”‚  â”‚  (audit DB)  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 6.2 Production Installation Steps

#### Step 1: ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°

```bash
# Ubuntu 22.04 LTS
sudo apt update && sudo apt upgrade -y

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Python 3.11
sudo apt install python3.11 python3.11-venv python3-pip -y

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° nginx
sudo apt install nginx -y

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
sudo useradd -r -s /bin/bash -d /opt/ad-control adcontrol
```


#### Step 2: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

```bash
# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
sudo su - adcontrol

# ÐšÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ/Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ°
mkdir -p /opt/ad-control/app
cd /opt/ad-control/app
# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ñ„Ð°Ð¹Ð»Ñ‹ main.py, index.html, requirements.txt

# Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
python3.11 -m venv venv
source venv/bin/activate

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ (production)
pip install -r requirements.txt
pip install gunicorn  # Process manager
```


#### Step 3: Database Setup

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð‘Ð” Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
sudo -u postgres psql << EOF
CREATE DATABASE ad_control_db;
CREATE USER ad_control_user WITH ENCRYPTED PASSWORD 'SecureDBPassword!';
GRANT ALL PRIVILEGES ON DATABASE ad_control_db TO ad_control_user;
\q
EOF

# Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ…ÐµÐ¼Ñ‹ (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ñ‡ÐµÑ€ÐµÐ· SQLAlchemy)
```


#### Step 4: Configuration

```bash
# Production .env
cat > /opt/ad-control/app/.env << 'EOF'
# Production Configuration
DEBUG=false
LOG_LEVEL=INFO

# AD Configuration
AD_SERVER=ldaps://dc01.corp.local
AD_DOMAIN=CORP
AD_BASE_DN=DC=corp,DC=local
AD_SYSTEM_USER=svc_ad_control
AD_SYSTEM_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# Database (PostgreSQL)
DATABASE_URL=postgresql://ad_control_user:SecureDBPassword!@localhost:5432/ad_control_db

# Security
JWT_SECRET_KEY=GENERATE_STRONG_SECRET_HERE_32_CHARS_MIN
JWT_EXPIRY_MINUTES=60

# Rate Limiting
RATE_LIMIT_STORAGE=memory  # Ð¸Ð»Ð¸ redis://localhost:6379

# Allowed OUs
ALLOWED_OUS=OU=Employees,DC=corp,DC=local;OU=Contractors,DC=corp,DC=local

# LDAP Pool
LDAP_POOL_SIZE=10

# Monitoring
PROMETHEUS_ENABLED=true
JSON_LOGGING=true
EOF

# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ JWT secret
python3 -c "import secrets; print('JWT_SECRET_KEY=' + secrets.token_urlsafe(32))" >> .env

# ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
chmod 600 .env
chown adcontrol:adcontrol .env
```


#### Step 5: Systemd Service

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ systemd unit
sudo cat > /etc/systemd/system/ad-control.service << 'EOF'
[Unit]
Description=AD Control System v7.1
After=network.target postgresql.service

[Service]
Type=notify
User=adcontrol
Group=adcontrol
WorkingDirectory=/opt/ad-control/app
Environment="PATH=/opt/ad-control/app/venv/bin"
ExecStart=/opt/ad-control/app/venv/bin/gunicorn main:app \
    --workers 4 \
    --worker-class uvicorn.workers.UvicornWorker \
    --bind 127.0.0.1:8080 \
    --access-logfile /opt/ad-control/logs/access.log \
    --error-logfile /opt/ad-control/logs/error.log \
    --log-level info
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð»Ð¾Ð³Ð¾Ð²
sudo mkdir -p /opt/ad-control/logs
sudo chown adcontrol:adcontrol /opt/ad-control/logs

# Ð—Ð°Ð¿ÑƒÑÐº Ð¸ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº
sudo systemctl daemon-reload
sudo systemctl enable ad-control
sudo systemctl start ad-control

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
sudo systemctl status ad-control
```


#### Step 6: Nginx Reverse Proxy

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ nginx
sudo cat > /etc/nginx/sites-available/ad-control << 'EOF'
upstream ad_control_backend {
    server 127.0.0.1:8080;
}

server {
    listen 443 ssl http2;
    server_name ad-control.corp.local;

    # SSL Configuration
    ssl_certificate /etc/ssl/certs/ad-control.crt;
    ssl_certificate_key /etc/ssl/private/ad-control.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # Security Headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # Logging
    access_log /var/log/nginx/ad-control-access.log;
    error_log /var/log/nginx/ad-control-error.log;

    # Gzip Compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript;

    # Static Files
    location / {
        proxy_pass http://ad_control_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket support (ÐµÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Rate Limiting (Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ)
    limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;
    
    location /api/v6/token {
        limit_req zone=login burst=3 nodelay;
        proxy_pass http://ad_control_backend;
    }
}

# HTTP redirect to HTTPS
server {
    listen 80;
    server_name ad-control.corp.local;
    return 301 https://$server_name$request_uri;
}
EOF

# ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo ln -s /etc/nginx/sites-available/ad-control /etc/nginx/sites-enabled/
sudo nginx -t  # Ð¢ÐµÑÑ‚ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo systemctl reload nginx
```


#### Step 7: SSL Certificate

```bash
# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ A: Self-signed (Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ)
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/ssl/private/ad-control.key \
    -out /etc/ssl/certs/ad-control.crt \
    -subj "/CN=ad-control.corp.local"

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ B: Let's Encrypt (Ð´Ð»Ñ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð²)
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d ad-control.corp.local

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ C: ÐšÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ CA (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
# ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð¾Ñ‚ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐ³Ð¾ CA
```


### 6.3 Production Verification Checklist

- [ ] ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ð¸ ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ Ð½Ð° 127.0.0.1:8080
- [ ] Nginx Ð¿Ñ€Ð¾ÐºÑÐ¸Ñ€ÑƒÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
- [ ] HTTPS Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ (SSL certificate valid)
- [ ] Database connection Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ (PostgreSQL)
- [ ] LDAP connection Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ (Ðº Domain Controller)
- [ ] Ð›Ð¾Ð³Ð¸ Ð¿Ð¸ÑˆÑƒÑ‚ÑÑ Ð² `/opt/ad-control/logs/`
- [ ] Backup directory ÑÐ¾Ð·Ð´Ð°Ð½Ð°: `/opt/ad-control/app/backups/`
- [ ] Health checks Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹:
    - [ ] `curl https://ad-control.corp.local/health`
    - [ ] `curl https://ad-control.corp.local/health/ldap`
    - [ ] `curl https://ad-control.corp.local/health/db`
- [ ] Login Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ (Ð´Ð¾Ð¼ÐµÐ½Ð½Ñ‹Ðµ credentials)
- [ ] Admin Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ (ÐµÑÐ»Ð¸ Ð²Ð¾ÑˆÐ»Ð¸ ÐºÐ°Ðº Domain Admin)
- [ ] Audit logs Ð¿Ð¸ÑˆÑƒÑ‚ÑÑ Ð² Ð‘Ð”
- [ ] Auto-backup ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð¿ÐµÑ€ÐµÐ´ Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ð¼Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑÐ¼Ð¸

***

## 7. ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð´ Ñ‚Ð¸Ð¿Ñ‹ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¹

### 7.1 Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: ÐœÐ°Ð»Ñ‹Ð¹ Ð¾Ñ„Ð¸Ñ (Flat Structure)

**Ð¥Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸:**

- 50-500 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- ÐžÐ´Ð½Ð° Ð»Ð¾ÐºÐ°Ñ†Ð¸Ñ
- Ð’ÑÐµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð² Ð¾Ð´Ð½Ð¾Ð¹ OU
- 1-2 IT Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°

**ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ:**

```ini
# .env Ð´Ð»Ñ Ð¼Ð°Ð»Ð¾Ð³Ð¾ Ð¾Ñ„Ð¸ÑÐ°
AD_SERVER=ldaps://dc.office.local
AD_DOMAIN=OFFICE
AD_BASE_DN=DC=office,DC=local
AD_SYSTEM_USER=admin
AD_SYSTEM_PASSWORD=OfficeAdminPass123!

# ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°
ALLOWED_OUS=OU=Users,DC=office,DC=local

# Ð›ÐµÐ³ÐºÐ¾Ð²ÐµÑÐ½Ð°Ñ Ð‘Ð”
DATABASE_URL=sqlite:///./audit.db

# ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿ÑƒÐ»
LDAP_POOL_SIZE=3

# Rate limits (relaxed)
RATE_LIMIT_LOGIN=10/minute
```

**Deployment:**

- Single server
- SQLite database
- No load balancer
- Local backups

***

### 7.2 Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: Ð¥Ð¾Ð»Ð´Ð¸Ð½Ð³ / Ð¤Ð¸Ð»Ð¸Ð°Ð»ÑŒÐ½Ð°Ñ ÑÐµÑ‚ÑŒ

**Ð¥Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸:**

- 500-5000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- Multiple locations
- Ð¡Ð»Ð¾Ð¶Ð½Ð°Ñ OU structure
- 3-10 Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²

**ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ:**

```ini
# .env Ð´Ð»Ñ Ñ…Ð¾Ð»Ð´Ð¸Ð½Ð³Ð°
AD_SERVER=ldaps://dc-hq.holding.com
AD_DOMAIN=HOLDING
AD_BASE_DN=DC=holding,DC=com

# Ð¡Ð»Ð¾Ð¶Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° OU (Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ñ„Ð¸Ð»Ð¸Ð°Ð»Ñ‹)
ALLOWED_OUS=OU=Users,OU=Moscow,DC=holding,DC=com;\
OU=Users,OU=StPetersburg,DC=holding,DC=com;\
OU=Users,OU=Kazan,DC=holding,DC=com;\
OU=Remote,DC=holding,DC=com

# PostgreSQL Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
DATABASE_URL=postgresql://adcontrol:dbpass@db.holding.com:5432/ad_control_prod

# Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ð¹ Ð¿ÑƒÐ»
LDAP_POOL_SIZE=15

# Ð¡Ñ‚Ñ€Ð¾Ð³Ð¸Ðµ rate limits
RATE_LIMIT_LOGIN=5/minute
RATE_LIMIT_CREATE=10/minute
RATE_LIMIT_MASS_UPDATE=3/minute
```

**Deployment:**

- Docker container
- PostgreSQL database (replicated)
- Nginx load balancer
- Network backups (NAS/SAN)

***

### 7.3 Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: Multi-Domain Forest (Enterprise)

**Ð¥Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸:**

- 5000+ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- Multiple domains Ð² forest
- Global Catalog search
- 10+ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²
- High Availability required

**ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ:**

```ini
# .env Ð´Ð»Ñ enterprise
AD_SERVER=ldaps://gc.enterprise.com:3269  # Global Catalog port!
AD_DOMAIN=ENTERPRISE
AD_BASE_DN=DC=enterprise,DC=com

# Multi-domain OUs
ALLOWED_OUS=OU=Users,DC=corp,DC=enterprise,DC=com;\
OU=Users,DC=subsidiary1,DC=enterprise,DC=com;\
OU=Users,DC=subsidiary2,DC=enterprise,DC=com;\
OU=External,DC=partners,DC=enterprise,DC=com

# PostgreSQL HA cluster
DATABASE_URL=postgresql://adcontrol:dbpass@pgpool.enterprise.com:5432/ad_control?target_session_attrs=read-write

# Maximum pool size
LDAP_POOL_SIZE=20

# Redis Ð´Ð»Ñ distributed rate limiting
RATE_LIMIT_STORAGE=redis://redis-cluster.enterprise.com:6379/0

# Stats caching
STATS_CACHE_ENABLED=true
STATS_CACHE_TTL=300
```

**Deployment:**

- Kubernetes cluster (3+ replicas)
- PostgreSQL HA (Primary-Standby with auto-failover)
- Redis cluster (Ð´Ð»Ñ rate limiting Ð¸ sessions)
- Load balancer (Ingress Controller)
- Centralized backups (S3-compatible storage)
- Prometheus + Grafana monitoring

***

## 8. High Availability Setup

### 8.1 HA Architecture

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  DNS Round     â”‚
                    â”‚  Robin / VIP   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Load Balancer â”‚       â”‚  Load Balancer â”‚
        â”‚  (nginx #1)    â”‚       â”‚  (nginx #2)    â”‚
        â”‚  + keepalived  â”‚       â”‚  + keepalived  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                         â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”
â”‚  App #1 â”‚  â”‚  App #2  â”‚  â”‚  App #3  â”‚  â”‚  App #4  â”‚
â”‚  (Pod)  â”‚  â”‚  (Pod)   â”‚  â”‚  (Pod)   â”‚  â”‚  (Pod)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚             â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  PostgreSQL HA  â”‚
         â”‚  Primary + Sync â”‚
         â”‚  Standby        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 8.2 Kubernetes Deployment

**deployment.yaml:**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ad-control
  namespace: it-systems
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ad-control
  template:
    metadata:
      labels:
        app: ad-control
    spec:
      containers:
      - name: ad-control
        image: your-registry/ad-control:v7.1
        ports:
        - containerPort: 8080
        env:
        - name: AD_SERVER
          valueFrom:
            secretKeyRef:
              name: ad-credentials
              key: server
        - name: AD_SYSTEM_USER
          valueFrom:
            secretKeyRef:
              name: ad-credentials
              key: username
        - name: AD_SYSTEM_PASSWORD
          valueFrom:
            secretKeyRef:
              name: ad-credentials
              key: password
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-credentials
              key: url
        - name: JWT_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: jwt-secret
              key: key
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health/ldap
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: ad-control-service
  namespace: it-systems
spec:
  selector:
    app: ad-control
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ad-control-ingress
  namespace: it-systems
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  tls:
  - hosts:
    - ad-control.company.com
    secretName: ad-control-tls
  rules:
  - host: ad-control.company.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: ad-control-service
            port:
              number: 80
# Ð§ÐÐ¡Ð¢Ð¬ III: Ð Ð£ÐšÐžÐ’ÐžÐ”Ð¡Ð¢Ð’Ðž ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð¯

## 9. ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¸ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¡ÐµÑÑÐ¸ÑÐ¼Ð¸

### 9.1 ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸

**Flow Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð°:**

```
User Browser
    â”‚
    â”œâ”€1â”€â–º ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ /index.html
    â”‚       â”‚
    â”‚       â””â”€â–º Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ JWT token â†’ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Login Modal
    â”‚
    â”œâ”€2â”€â–º Ð’Ð²Ð¾Ð´Ð¸Ñ‚ credentials (DOMAIN\username, password)
    â”‚
    â”œâ”€3â”€â–º POST /api/v6/token
    â”‚       â”‚
    â”‚       â”œâ”€â–º Backend: LDAP Bind (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° credentials)
    â”‚       â”‚     â”‚
    â”‚       â”‚     â”œâ”€SUCCESSâ”€â–º ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° UAC (Ð½Ðµ disabled?)
    â”‚       â”‚     â”‚              â”‚
    â”‚       â”‚     â”‚              â”œâ”€â–º ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ (Domain Admins?)
    â”‚       â”‚     â”‚              â”‚     â”œâ”€YESâ”€â–º role = "admin"
    â”‚       â”‚     â”‚              â”‚     â””â”€NOâ”€â”€â–º role = "user"
    â”‚       â”‚     â”‚              â”‚
    â”‚       â”‚     â”‚              â””â”€â–º Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ JWT token
    â”‚       â”‚     â”‚                    - payload: {username, role}
    â”‚       â”‚     â”‚                    - expiry: 60 minutes
    â”‚       â”‚     â”‚                    - signature: HS256
    â”‚       â”‚     â”‚
    â”‚       â”‚     â””â”€FAILâ”€â”€â–º HTTP 401 Unauthorized
    â”‚       â”‚
    â”‚       â””â”€4â”€â–º Return: {access_token: "eyJ...", token_type: "bearer"}
    â”‚
    â”œâ”€5â”€â–º Browser: Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ token Ð² sessionStorage
    â”‚       â”‚
    â”‚       â””â”€â–º Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Login Modal, Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Dashboard
    â”‚
    â””â”€6â”€â–º Ð’ÑÐµ Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ API calls:
            Authorization: Bearer eyJ...
```


### 9.2 Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ€Ð¾Ð»ÑÐ¼Ð¸ (RBAC)

**Ð Ð¾Ð»Ð¸ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ:**


| Ð Ð¾Ð»ÑŒ | Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº | Ð”Ð¾ÑÑ‚ÑƒÐ¿ |
| :-- | :-- | :-- |
| **admin** | Member of Domain Admins Ð¸Ð»Ð¸ custom group | CRUD users/groups/computers, Mass operations, Workflows, Plugins |
| **user** | Ð›ÑŽÐ±Ð¾Ð¹ authenticated domain user | Read-only access, Self-service (password change) |
| **anonymous** | ÐÐµ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½ | Ð¢Ð¾Ð»ÑŒÐºÐ¾ Login page |

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð¾Ð»Ð¸ Ð² API:**

```python
# Ð’ main.py
def require_admin(user = Depends(get_current_user)):
    if user.get('role') != 'admin':
        raise HTTPException(403, "Admin role required")
    return user

# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:
@app.post("/api/v6/ad/users/create")
def create_user(data: UserCreateRequest, user=Depends(require_admin)):
    # Ð¢Ð¾Ð»ÑŒÐºÐ¾ admin Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
    ...
```


### 9.3 Session Management

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÐµÑÑÐ¸Ð¸:**

- **Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ:** sessionStorage (Ð½Ðµ cookies) â†’ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¸ Ð²ÐºÐ»Ð°Ð´ÐºÐ¸
- **Expiry:** 60 Ð¼Ð¸Ð½ÑƒÑ‚ (configurable)
- **Refresh:** ÐÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ refresh (Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²Ð¾Ð¹Ñ‚Ð¸ Ð·Ð°Ð½Ð¾Ð²Ð¾)
- **Logout:** `sessionStorage.clear()` + redirect Ð½Ð° /index.html

**Frontend ÐºÐ¾Ð´ (Ð² index.html):**

```javascript
// Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾ÐºÐµÐ½Ð°
sessionStorage.setItem('jwt_token', response.access_token);

// Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ
async function req(url, opts={}) {
    const token = sessionStorage.getItem('jwt_token');
    if (!opts.headers) opts.headers = {};
    opts.headers.Authorization = `Bearer ${token}`;
    
    const res = await fetch(API + url, opts);
    
    if (res.status === 401) {
        // Token expired or invalid
        sessionStorage.clear();
        $('#login-modal').fadeIn();
        return null;
    }
    
    return await res.json();
}

// Logout
function logout() {
    sessionStorage.clear();
    location.reload();
}
```


### 9.4 Security Best Practices

**Ð”Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹:**

- âœ… Ð’ÑÐµÐ³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ HTTPS (Ð½Ðµ HTTP!)
- âœ… ÐÐµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐ¹Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ð¸ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ Ð½Ð° Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ð°Ñ…
- âœ… Ð—Ð°Ð²ÐµÑ€ÑˆÐ°Ð¹Ñ‚Ðµ ÑÐµÑÑÐ¸ÑŽ (Logout) Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ð¸ (8+ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð², mixed case, digits)

**Ð”Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²:**

- âœ… ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð¿Ð¾ IP (firewall rules)
- âœ… Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ Ñ€Ð¾Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ JWT_SECRET_KEY
- âœ… ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€ÑŒÑ‚Ðµ audit logs Ð½Ð° Ð¿Ð¾Ð´Ð¾Ð·Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½ÑƒÑŽ service account (Ð½Ðµ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ admin account)

***

## 10. Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð¸ ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

### 10.1 Widgets Overview

**4 Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð°:**

#### 1. Total Users

```javascript
// Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð´Ð°Ð½Ð½Ñ‹Ñ…: GET /api/v6/stats
{
    "total_users": 1523,  // ÐšÐ¾Ð»-Ð²Ð¾ objectClass=user Ð² AD
    "active_users": 1456, // UAC Ð±ÐµÐ· Ñ„Ð»Ð°Ð³Ð° 2
    "disabled_users": 67  // UAC Ñ Ñ„Ð»Ð°Ð³Ð¾Ð¼ 2
}
```

**ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ:**

```html
<div class="card border-start border-4 border-primary">
    <h3><span id="s-users">1523</span></h3>
    <div class="text-muted">ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹</div>
    <small class="text-success">+12 Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ</small>
</div>
```


#### 2. Successful Operations

```javascript
// Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº: Database query
db.query(AuditRecord).filter_by(status="SUCCESS").count()

// ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÐµÑÑÐ¸Ð¸
{
    "successful_updates": 245,  // Ð—Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 24 Ñ‡Ð°ÑÐ°
    "failed_operations": 3,
    "success_rate": "98.8%"
}
```


#### 3. Pending Backups

```javascript
// Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº: File system scan
len(list(BACKUP_DIR.glob("*.json")))

// ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ
{
    "pending_backups": 15,  // ÐšÐ¾Ð»-Ð²Ð¾ JSON Ñ„Ð°Ð¹Ð»Ð¾Ð²
    "oldest_backup": "2025-11-15 10:23:45",
    "total_size": "25.3 MB"
}
```


#### 4. System Health

```javascript
// ÐÐ³Ñ€ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ
{
    "ldap_status": "OK",     // /health/ldap
    "db_status": "OK",       // /health/db
    "overall": "Healthy",
    "uptime": "15 days 3 hours"
}
```


### 10.2 Customizable Layout (Drag-and-Drop)

**Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð¾Ð²:**

```javascript
// Frontend (Sortable.js)
new Sortable(document.getElementById('dashboard-grid'), {
    animation: 150,
    onEnd: function(evt) {
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð¾Ð²
        const widgetOrder = $('.widget-item').map(function() {
            return $(this).data('widget-id');
        }).get();
        
        // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð½Ð° backend
        saveDashboardLayout(widgetOrder);
    }
});

async function saveDashboardLayout(order) {
    await req('/config/dashboard', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({widgets: order})
    });
    showToast("OK", "Dashboard layout saved");
}
```

**Backend (ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² UserSettings):**

```python
@app.post("/api/v6/config/dashboard")
def save_dashboard_config(config: dict, user=Depends(get_current_user), db: Session = Depends(get_db)):
    # ÐÐ°Ð¹Ñ‚Ð¸ Ð¸Ð»Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    settings = db.query(UserSettings).filter_by(username=user['username']).first()
    if not settings:
        settings = UserSettings(username=user['username'])
        db.add(settings)
    
    # Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð¾Ð²
    settings.dashboard_widgets = json.dumps(config['widgets'])
    db.commit()
    
    return {"status": "saved"}
```


### 10.3 Activity Chart (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)

**Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Chart.js:**

```html
<canvas id="mainChart" height="80"></canvas>

<script>
// Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹
async function loadActivityChart() {
    const data = await req('/stats/activity?days=7');
    
    const ctx = document.getElementById('mainChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.dates, // ['2025-11-14', '2025-11-15', ...]
            datasets: [{
                label: 'User Operations',
                data: data.operations, // [45, 67, 52, ...]
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}
</script>
```


***

## 11. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸

### 11.1 Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ (Browser)

**Features:**

- âœ… Pagination (server-side: 50 users/page)
- âœ… Search (Ð¿Ð¾ displayName, sAMAccountName, mail)
- âœ… Filter (All / Active / Disabled)
- âœ… Sort (Ð»ÑŽÐ±Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°)
- âœ… Bulk selection (checkbox)

**UI Elements:**

```html
<!-- Search Bar -->
<div class="card p-3 mb-3">
    <div class="row g-2">
        <div class="col-md-4">
            <input id="search-q" class="form-control" placeholder="ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸, Ð»Ð¾Ð³Ð¸Ð½Ñƒ...">
        </div>
        <div class="col-md-2">
            <select id="search-f" class="form-control">
                <option value="all">Ð’ÑÐµ</option>
                <option value="enabled">ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ</option>
                <option value="disabled">Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ</option>
            </select>
        </div>
        <div class="col-md-2">
            <button onclick="loadUsers()" class="btn btn-dark w-100">
                <i class="fas fa-search"></i> ÐÐ°Ð¹Ñ‚Ð¸
            </button>
        </div>
    </div>
</div>

<!-- Bulk Actions Toolbar -->
<div class="mb-2 d-flex gap-2">
    <button onclick="bulk('disable')" class="btn btn-danger btn-sm">
        <i class="fas fa-lock"></i> Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
    </button>
    <button onclick="bulk('enable')" class="btn btn-success btn-sm">
        <i class="fas fa-unlock"></i> Ð Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
    </button>
    <button onclick="exportData('csv')" class="btn btn-secondary btn-sm">
        <i class="fas fa-download"></i> Export CSV
    </button>
    <button onclick="exportData('xlsx')" class="btn btn-secondary btn-sm">
        <i class="fas fa-file-excel"></i> Export Excel
    </button>
</div>

<!-- Users Table -->
<table id="users-table" class="table table-hover">
    <thead>
        <tr>
            <th><input type="checkbox" id="select-all"></th>
            <th>Name</th>
            <th>Login</th>
            <th>Department</th>
            <th>Title</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        <!-- Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· JavaScript -->
    </tbody>
</table>

<!-- Pagination (DataTables handles this) -->
```


### 11.2 Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

**Modal Ñ„Ð¾Ñ€Ð¼Ð°:**

```html
<div class="modal fade" id="userModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label>Ð˜Ð¼Ñ <span class="text-danger">*</span></label>
                        <input id="n-name" class="form-control" placeholder="Ð˜Ð²Ð°Ð½">
                    </div>
                    <div class="col-md-6">
                        <label>Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ <span class="text-danger">*</span></label>
                        <input id="n-sn" class="form-control" placeholder="Ð˜Ð²Ð°Ð½Ð¾Ð²">
                    </div>
                    <div class="col-md-6">
                        <label>Ð›Ð¾Ð³Ð¸Ð½ <span class="text-danger">*</span></label>
                        <input id="n-login" class="form-control" placeholder="i.ivanov">
                        <small class="text-muted">Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð»Ð°Ñ‚Ð¸Ð½Ð¸Ñ†Ð°, Ñ†Ð¸Ñ„Ñ€Ñ‹, Ñ‚Ð¾Ñ‡ÐºÐ¸</small>
                    </div>
                    <div class="col-md-6">
                        <label>Email</label>
                        <input id="n-email" type="email" class="form-control" placeholder="i.ivanov@corp.com">
                    </div>
                    <div class="col-md-6">
                        <label>ÐŸÐ°Ñ€Ð¾Ð»ÑŒ <span class="text-danger">*</span></label>
                        <input id="n-pass" type="password" class="form-control">
                        <small class="text-muted">ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ 8 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð², Ñ†Ð¸Ñ„Ñ€Ñ‹, Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€</small>
                    </div>
                    <div class="col-md-6">
                        <label>ÐžÑ‚Ð´ÐµÐ»</label>
                        <input id="n-dept" class="form-control" placeholder="IT">
                    </div>
                    <div class="col-md-6">
                        <label>Ð”Ð¾Ð»Ð¶Ð½Ð¾ÑÑ‚ÑŒ</label>
                        <input id="n-title" class="form-control" placeholder="System Administrator">
                    </div>
                    <div class="col-md-6">
                        <label>OU <span class="text-danger">*</span></label>
                        <select id="n-ou" class="form-control">
                            <option value="OU=Employees,DC=corp,DC=local">Employees</option>
                            <option value="OU=IT,DC=corp,DC=local">IT</option>
                            <option value="OU=Contractors,DC=corp,DC=local">Contractors</option>
                        </select>
                    </div>
                    <div class="col-md-12">
                        <div class="form-check">
                            <input id="n-enabled" type="checkbox" class="form-check-input" checked>
                            <label class="form-check-label">Ð£Ñ‡ÐµÑ‚Ð½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                <button onclick="createUser()" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i> Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ
                </button>
            </div>
        </div>
    </div>
</div>
```

**JavaScript Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°:**

```javascript
async function createUser() {
    // Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð½Ð° frontend
    const login = $('#n-login').val();
    const password = $('#n-pass').val();
    
    if (!login || !password) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð²ÑÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ");
        return;
    }
    
    // Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¿Ð°Ñ€Ð¾Ð»Ñ (4 Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°)
    if (password.length < 8) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 8 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²");
        return;
    }
    if (!/[A-Z]/.test(password)) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð·Ð°Ð³Ð»Ð°Ð²Ð½Ñ‹Ðµ Ð±ÑƒÐºÐ²Ñ‹");
        return;
    }
    if (!/[a-z]/.test(password)) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ ÑÑ‚Ñ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð±ÑƒÐºÐ²Ñ‹");
        return;
    }
    if (!/\d/.test(password)) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ñ†Ð¸Ñ„Ñ€Ñ‹");
        return;
    }
    
    // Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…
    const userData = {
        givenName: $('#n-name').val(),
        sn: $('#n-sn').val(),
        sAMAccountName: login,
        password: password,
        mail: $('#n-email').val(),
        department: $('#n-dept').val(),
        title: $('#n-title').val(),
        ou: $('#n-ou').val(),
        enabled: $('#n-enabled').is(':checked')
    };
    
    // API call
    $('#loader').show();
    const res = await req('/ad/users/create', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(userData)
    });
    $('#loader').hide();
    
    if (res?.status === 'success') {
        showToast("Ð£ÑÐ¿ÐµÑ…", `ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ${login} ÑÐ¾Ð·Ð´Ð°Ð½`);
        $('#userModal').modal('hide');
        loadUsers(); // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ
        
        // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ñ‹
        $('#n-name, #n-sn, #n-login, #n-pass, #n-email, #n-dept, #n-title').val('');
    } else {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", res?.detail || "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ");
    }
}
```


### 11.3 Bulk Operations (ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ)

**Lock/Unlock Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹:**

```javascript
async function bulk(action) {
    // ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ DN
    const selectedDNs = $('.sel:checked').map((_, el) => el.value).get();
    
    if (selectedDNs.length === 0) {
        showToast("Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ", "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹");
        return;
    }
    
    // ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ
    const actionText = action === 'disable' ? 'Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ' : 'Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ';
    if (!confirm(`Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ${actionText} ${selectedDNs.length} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹?`)) {
        return;
    }
    
    // API call
    $('#loader').show();
    const res = await req('/ad/users/toggle', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            dns: selectedDNs,
            action: action
        })
    });
    $('#loader').hide();
    
    if (res) {
        // ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÑƒÑÐ¿ÐµÑ…Ð¾Ð²
        const successCount = res.results.filter(r => r.status === 'ok').length;
        const errorCount = res.results.filter(r => r.status === 'error').length;
        
        if (errorCount === 0) {
            showToast("Ð£ÑÐ¿ÐµÑ…", `${successCount} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ ${actionText === 'Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ' ? 'Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹' : 'Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹'}`);
        } else {
            showToast("Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑƒÑÐ¿ÐµÑ…", `Ð£ÑÐ¿ÐµÑˆÐ½Ð¾: ${successCount}, ÐžÑˆÐ¸Ð±ÐºÐ¸: ${errorCount}`);
            
            // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
            const errorDetails = res.results
                .filter(r => r.status === 'error')
                .map(r => `${r.dn}: ${r.msg}`)
                .join('\n');
            console.error('Bulk operation errors:', errorDetails);
        }
        
        // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ
        loadUsers();
        
        // Ð¡Ð½ÑÑ‚ÑŒ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ
        $('.sel').prop('checked', false);
        $('#select-all').prop('checked', false);
    }
}
```


***

## 14. ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¸Ð· Excel

### 14.1 ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° (Step-by-Step)

**ÐžÐ±Ñ‰Ð¸Ð¹ flow:**

```
Step 1: Upload Excel â†’ 
Step 2: Parse & Show Columns â†’ 
Step 3: Drag-and-Drop Mapping â†’ 
Step 4: Validate Mapping â†’ 
Step 5: Mass Update Execution â†’ 
Step 6: Show Results & Log
```


### 14.2 Step 1-2: Upload Ð¸ Parsing

**Frontend ÐºÐ¾Ð´:**

```html
<div class="card p-4" id="step1">
    <h5>Ð¨Ð°Ð³ 1: Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Excel Ñ„Ð°Ð¹Ð»</h5>
    <input type="file" id="excel-file" class="form-control" 
           accept=".xlsx,.xls" 
           onchange="uploadExcel()">
    <small class="text-muted mt-2">
        ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹: .xlsx, .xls
    </small>
</div>

<script>
async function uploadExcel() {
    const fileInput = document.getElementById('excel-file');
    const file = fileInput.files[0];
    
    if (!file) return;
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° (Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 10MB)
    if (file.size > 10 * 1024 * 1024) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "Ð¤Ð°Ð¹Ð» ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ (Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 10MB)");
        return;
    }
    
    // Upload
    const formData = new FormData();
    formData.append('file', file);
    
    $('#loader').show();
    const res = await req('/import-excel/', {
        method: 'POST',
        body: formData
    });
    $('#loader').hide();
    
    if (res) {
        // Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ
        window.excelData = res.data;
        
        // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Step 2
        $('#step1').hide();
        $('#step2').show();
        
        // Render source columns
        renderSourceColumns(res.columns);
        
        // Initialize drag-and-drop
        initializeDragDrop();
    } else {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»");
    }
}
</script>
```

**Backend (Ð² main.py):**

```python
@app.post("/api/v6/import-excel/")
async def import_excel(file: UploadFile = File(...), user=Depends(require_admin)):
    """Parse uploaded Excel file and return columns + data"""
    try:
        # Ð§Ñ‚ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ð² pandas
        contents = await file.read()
        df = pd.read_excel(io.BytesIO(contents))
        
        # Ð—Ð°Ð¼ÐµÐ½Ð° NaN Ð½Ð° Ð¿ÑƒÑÑ‚Ñ‹Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸
        df = df.fillna('')
        
        # ÐšÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ñ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ»Ð¾Ð²Ð°Ñ€ÐµÐ¹
        data = df.to_dict('records')
        
        # ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº
        columns = df.columns.tolist()
        
        return {
            "status": "success",
            "columns": columns,
            "data": data,
            "rows": len(data)
        }
    except Exception as e:
        logger.error(f"Excel import error: {e}")
        raise HTTPException(400, f"Failed to parse Excel: {str(e)}")
```


### 14.3 Step 3: Drag-and-Drop Mapping

**UI Structure:**

```html
<div class="card p-4 mt-3" id="step2" style="display:none">
    <h5>Ð¨Ð°Ð³ 2: Ð¡Ð¾Ð¿Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ð¾Ð»Ñ</h5>
    <div class="row">
        <!-- Source Columns (Left) -->
        <div class="col-4">
            <h6>ÐšÐ¾Ð»Ð¾Ð½ÐºÐ¸ Ð¸Ð· Excel</h6>
            <div id="src-cols" style="max-height:400px; overflow-y:auto">
                <!-- Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸: ÑÐµÑ€Ñ‹Ðµ Ð±Ð»Ð¾ÐºÐ¸ -->
            </div>
        </div>
        
        <!-- Arrow -->
        <div class="col-1 text-center">
            <i class="fas fa-arrow-right fa-2x text-muted mt-5"></i>
        </div>
        
        <!-- Drop Zones (Right) -->
        <div class="col-7">
            <h6>ÐŸÐ¾Ð»Ñ Active Directory</h6>
            <div class="row">
                <div class="col-12">
                    <small class="text-danger">* Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)</small>
                    <div class="drop-zone" data-ad="identifier"></div>
                    <small class="text-muted">employeeID Ð¸Ð»Ð¸ sAMAccountName</small>
                </div>
                <div class="col-6">
                    <small>ÐžÑ‚Ð´ÐµÐ»</small>
                    <div class="drop-zone" data-ad="department"></div>
                </div>
                <div class="col-6">
                    <small>Ð”Ð¾Ð»Ð¶Ð½Ð¾ÑÑ‚ÑŒ</small>
                    <div class="drop-zone" data-ad="title"></div>
                </div>
                <div class="col-6">
                    <small>Email</small>
                    <div class="drop-zone" data-ad="mail"></div>
                </div>
                <div class="col-6">
                    <small>Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½</small>
                    <div class="drop-zone" data-ad="telephoneNumber"></div>
                </div>
                <div class="col-12">
                    <small>ÐÐ´Ñ€ÐµÑ</small>
                    <div class="drop-zone" data-ad="streetAddress"></div>
                </div>
            </div>
        </div>
    </div>
    
    <button onclick="runUpdate()" class="btn btn-success mt-3">
        <i class="fas fa-play"></i> ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
    </button>
</div>
```

**JavaScript Ð´Ð»Ñ Drag-and-Drop:**

```javascript
function renderSourceColumns(columns) {
    const html = columns.map(col => 
        `<div class='col-item' data-col='${col}'>${col}</div>`
    ).join('');
    
    $('#src-cols').html(html);
}

function initializeDragDrop() {
    // Source columns (clone mode)
    new Sortable(document.getElementById('src-cols'), {
        group: {
            name: 'shared',
            pull: 'clone',  // ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ, Ð½Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰Ð°Ñ‚ÑŒ
            put: false
        },
        sort: false,
        animation: 150
    });
    
    // Drop zones (accept 1 item max)
    $('.drop-zone').each(function() {
        new Sortable(this, {
            group: 'shared',
            animation: 150,
            onAdd: function(evt) {
                // Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ item, ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ
                if (this.el.children.length > 1) {
                    this.el.removeChild(this.el.children[0]);
                }
            }
        });
    });
}
```


### 14.4 Step 4-5: Validation \& Execution

```javascript
async function runUpdate() {
    // Build mapping object
    const mapping = {};
    
    $('.drop-zone').each(function() {
        const adField = $(this).data('ad');
        const excelCol = $(this).find('.col-item').data('col');
        
        if (excelCol) {
            mapping[adField] = excelCol;
        }
    });
    
    // Validate: identifier is required
    if (!mapping.identifier) {
        showToast("ÐžÑˆÐ¸Ð±ÐºÐ°", "Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»Ðµ Ð´Ð»Ñ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° (employeeID Ð¸Ð»Ð¸ sAMAccountName)");
        return;
    }
    
    // Transform data to items
    const items = window.excelData.map(row => {
        const fields = {};
        
        // Map all fields except identifier
        for (let adField in mapping) {
            if (adField !== 'identifier') {
                const excelCol = mapping[adField];
                fields[adField] = String(row[excelCol] || '');
            }
        }
        
        return {
            identifier: String(row[mapping.identifier]),
            fields: fields
        };
    });
    
    // ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ
    if (!confirm(`Ð‘ÑƒÐ´ÐµÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ ${items.length} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ?`)) {
        return;
    }
    
    // API call
    $('#loader').show();
    const res = await req('/mass-update-exec/', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(items)
    });
    $('#loader').hide();
    
    if (res) {
        // Show results
        $('#import-log').show();
        
        const logHtml = res.log.map(entry => {
            const statusClass = entry.status === 'ok' ? 'text-success' : 
                               entry.status === 'error' ? 'text-danger' : 
                               'text-warning';
            
            return `<div class="${statusClass}">
                ${entry.status.toUpperCase()}: ${entry.id}
                ${entry.msg ? `- ${entry.msg}` : ''}
            </div>`;
        }).join('');
        
        $('#import-log').html(logHtml);
        
        // Summary
        showToast("Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾", 
            `Ð£ÑÐ¿ÐµÑˆÐ½Ð¾: ${res.updated}, ÐžÑˆÐ¸Ð±ÐºÐ¸: ${res.errors}`
        );
    }
}
```


### 14.5 Best Practices Ð´Ð»Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°

**ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Excel Ñ„Ð°Ð¹Ð»Ð°:**

1. âœ… ÐŸÐµÑ€Ð²Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° â€” Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº
2. âœ… Ð‘ÐµÐ· Ð¿ÑƒÑÑ‚Ñ‹Ñ… ÑÑ‚Ñ€Ð¾Ðº Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ
3. âœ… Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼
4. âœ… Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚: .xlsx (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ) Ð¸Ð»Ð¸ .xls
5. âœ… Encoding: UTF-8 (Ð´Ð»Ñ ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†Ñ‹)

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¹ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹:**

```
| Ð¢Ð°Ð±.Ð½Ð¾Ð¼ÐµÑ€ | Ð¤Ð˜Ðž              | ÐžÑ‚Ð´ÐµÐ» | Ð”Ð¾Ð»Ð¶Ð½Ð¾ÑÑ‚ÑŒ           | Email                |
|-----------|------------------|-------|---------------------|----------------------|
| 12345     | Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜.Ð˜.      | IT    | Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð°Ð´Ð¼Ð¸Ð½     | i.ivanov@corp.com    |
| 12346     | ÐŸÐµÑ‚Ñ€Ð¾Ð² ÐŸ.ÐŸ.      | HR    | ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¿Ð¾ Ð¿ÐµÑ€ÑÐ¾Ð½. | p.petrov@corp.com    |
| 12347     | Ð¡Ð¸Ð´Ð¾Ñ€Ð¾Ð²Ð° Ð¡.Ð¡.    | Sales | ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¿Ñ€Ð¾Ð´Ð°Ð¶     | s.sidorova@corp.com  |
```

**ÐœÐ°Ð¿Ð¿Ð¸Ð½Ð³ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°:**

- Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ â† "Ð¢Ð°Ð±.Ð½Ð¾Ð¼ÐµÑ€" (Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ employeeID Ð² AD)
- ÐžÑ‚Ð´ÐµÐ» â† "ÐžÑ‚Ð´ÐµÐ»" (department)
- Ð”Ð¾Ð»Ð¶Ð½Ð¾ÑÑ‚ÑŒ â† "Ð”Ð¾Ð»Ð¶Ð½Ð¾ÑÑ‚ÑŒ" (title)
- Email â† "Email" (mail)

***

## 17. Visual Workflow Engine

### 17.1 ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Workflow

```
Trigger Event (e.g., user_created)
    â”‚
    â”œâ”€â–º WorkflowEngine.trigger_event("user_created", context)
    â”‚       â”‚
    â”‚       â”œâ”€â–º Scan all workflows/*.json files
    â”‚       â”‚
    â”‚       â”œâ”€â–º Filter: workflow.trigger == "user_created"
    â”‚       â”‚
    â”‚       â””â”€â–º For each matching workflow:
    â”‚               â”‚
    â”‚               â”œâ”€â–º Execute steps sequentially
    â”‚               â”‚   â”‚
    â”‚               â”‚   â”œâ”€â–º Step 1: Email
    â”‚               â”‚   â”œâ”€â–º Step 2: Webhook
    â”‚               â”‚   â”œâ”€â–º Step 3: Condition
    â”‚               â”‚   â”‚       â”œâ”€â–º If True: Execute "then" steps
    â”‚               â”‚   â”‚       â””â”€â–º If False: Execute "else" steps
    â”‚               â”‚   â””â”€â–º Step N: Add to Group
    â”‚               â”‚
    â”‚               â””â”€â–º Return results
```


### 17.2 Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Workflow Ñ‡ÐµÑ€ÐµÐ· UI

**ÐŸÑ€Ð¸Ð¼ÐµÑ€: "ÐÐ¾Ð²Ñ‹Ð¹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº"**

**JSON ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°:**

```json
{
  "id": "new_employee_onboarding",
  "name": "ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ð½Ð±Ð¾Ñ€Ð´Ð¸Ð½Ð³ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°",
  "trigger": "user_created",
  "enabled": true,
  "steps": [
    {
      "type": "condition",
      "field": "department",
      "operator": "eq",
      "value": "IT",
      "then": [
        {
          "type": "add_to_group",
          "group_dn": "CN=IT-Users,OU=Groups,DC=corp,DC=local"
        },
        {
          "type": "webhook",
          "url": "https://jira.corp.local/api/create-ticket",
          "method": "POST",
          "data": {
            "project": "ITOPS",
            "summary": "Setup workstation for {{displayName}}",
            "description": "New IT employee requires laptop and accounts"
          }
        }
      ],
      "else": [
        {
          "type": "add_to_group",
          "group_dn": "CN=Regular-Users,OU=Groups,DC=corp,DC=local"
        }
      ]
    },
    {
      "type": "email",
      "to": "{{mail}}",
      "subject": "Welcome to Company!",
      "body": "Dear {{displayName}},\n\nWelcome aboard!\n\nYour login: {{sAMAccountName}}"
    }
  ]
}
```

**UI Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ (simplified):**

```html
<div id="view-workflow-editor" style="display:none">
    <h2>Workflow Editor</h2>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card p-3">
                <h5>Steps</h5>
                <div id="workflow-steps">
                    <!-- Steps Ð±ÑƒÐ´ÑƒÑ‚ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ -->
                </div>
                <button onclick="addWorkflowStep()" class="btn btn-primary mt-2">
                    + Add Step
                </button>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card p-3">
                <h5>Settings</h5>
                <div class="mb-3">
                    <label>Name</label>
                    <input id="wf-name" class="form-control" placeholder="My Workflow">
                </div>
                <div class="mb-3">
                    <label>Trigger</label>
                    <select id="wf-trigger" class="form-control">
                        <option value="manual">Manual Run</option>
                        <option value="user_created">After User Create</option>
                        <option value="user_modified">After User Edit</option>
                        <option value="user_disabled">User Disabled</option>
                    </select>
                </div>
                <button onclick="saveWorkflow()" class="btn btn-success w-100">
                    Save
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let currentSteps = [];

function addWorkflowStep() {
    const step = {
        id: Date.now(),
        type: 'email',
        config: {}
    };
    currentSteps.push(step);
    renderSteps();
}

function renderSteps() {
    const html = currentSteps.map((step, idx) => `
        <div class="card p-2 mb-2">
            <strong>Step ${idx + 1}</strong>
            <select onchange="updateStepType(${step.id}, this.value)">
                <option value="email" ${step.type==='email'?'selected':''}>Send Email</option>
                <option value="webhook" ${step.type==='webhook'?'selected':''}>Webhook</option>
                <option value="add_to_group" ${step.type==='add_to_group'?'selected':''}>Add to Group</option>
                <option value="condition" ${step.type==='condition'?'selected':''}>Condition (If/Else)</option>
            </select>
            
            ${renderStepConfig(step)}
            
            <button onclick="removeStep(${step.id})" class="btn btn-sm btn-danger">
                Delete
            </button>
        </div>
    `).join('');
    
    $('#workflow-steps').html(html);
}

function renderStepConfig(step) {
    if (step.type === 'email') {
        return `
            <input type="text" placeholder="To: {{mail}}" 
                   value="${step.config.to || ''}"
                   onchange="updateStepConfig(${step.id}, 'to', this.value)">
            <textarea placeholder="Body" 
                      onchange="updateStepConfig(${step.id}, 'body', this.value)">${step.config.body || ''}</textarea>
        `;
    } else if (step.type === 'webhook') {
        return `
            <input type="text" placeholder="URL" 
                   value="${step.config.url || ''}"
                   onchange="updateStepConfig(${step.id}, 'url', this.value)">
        `;
    } else if (step.type === 'add_to_group') {
        return `
            <input type="text" placeholder="Group DN" 
                   value="${step.config.group_dn || ''}"
                   onchange="updateStepConfig(${step.id}, 'group_dn', this.value)">
        `;
    } else if (step.type === 'condition') {
        return `
            <input type="text" placeholder="Field (e.g., department)" 
                   value="${step.config.field || ''}"
                   onchange="updateStepConfig(${step.id}, 'field', this.value)">
            <select onchange="updateStepConfig(${step.id}, 'operator', this.value)">
                <option value="eq">Equals</option>
                <option value="neq">Not Equals</option>
                <option value="contains">Contains</option>
            </select>
            <input type="text" placeholder="Value" 
                   value="${step.config.value || ''}"
                   onchange="updateStepConfig(${step.id}, 'value', this.value)">
        `;
    }
    return '';
}

async function saveWorkflow() {
    const workflow = {
        id: Date.now().toString(),
        name: $('#wf-name').val() || 'Untitled',
        trigger: $('#wf-trigger').val(),
        enabled: true,
        steps: currentSteps.map(s => ({
            type: s.type,
            ...s.config
        }))
    };
    
    const res = await req('/workflows', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(workflow)
    });
    
    if (res) {
        showToast("Ð£ÑÐ¿ÐµÑ…", "Workflow saved");
        nav('workflow');
    }
}
</script>

## Ð§ÐÐ¡Ð¢Ð¬ IV: ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð—ÐÐ¦Ð˜Ð¯

### 18. Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Workflow Templates

- New Employee Onboarding:
    - Trigger: user_created â†’ Steps: condition(department), add_to_group, webhook(Jira), email(stub).[^1]
- Offboarding:
    - Trigger: user_disabled â†’ Steps: webhook(ITSM), add_to_group(Disabled Accounts).[^1]
- Departmental Auto-Group:
    - Trigger: user_modified â†’ Steps: condition(department contains X), add_to_group.[^1]

Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ JSON ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð²: id, name, trigger, enabled, steps[] ÑÐ¾ step.type âˆˆ {email, webhook, add_to_group, condition}, Ð° Ð´Ð»Ñ condition â€” Ð¿Ð¾Ð»Ñ field, operator âˆˆ {eq, neq, contains}, value, then[], else[].[^1]

### 19. Scheduled Tasks (Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸Ðº)

- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ schedule, Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸Ðº ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑÑ Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ð¿Ð¾Ñ‚Ð¾ÐºÐµ Ð½Ð° ÑÑ‚Ð°Ñ€Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (run_scheduler).[^1]
- Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹: ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¾ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑƒÑ‡ÐµÑ‚Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ð¸ÑÑÑ… Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¾Ð¹ webhook Ð² Teams/Slack Ñ‡ÐµÑ€ÐµÐ· SafeRequests.[^1]

***

## Ð§ÐÐ¡Ð¢Ð¬ V: Ð ÐÐ—Ð ÐÐ‘ÐžÐ¢ÐšÐ ÐŸÐ›ÐÐ“Ð˜ÐÐžÐ’

### 20. ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Plugin System

- ÐŸÐ»Ð°Ð³Ð¸Ð½Ñ‹ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ðµ plugins/*.py, Ð¿Ð¾Ð´Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ðµ (Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ñ‡ÐµÑ€ÐµÐ· load_plugins).[^1]
- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð´Ð°: Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ (import os, subprocess, exec(, eval(, __import__, shutil, sys.modules, open() Ð¸ Ñ‚.Ð¿.).[^1]
- Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð² Ð¿ÐµÑÐ¾Ñ‡Ð½Ð¸Ñ†Ðµ: ÑƒÑ€ÐµÐ·Ð°Ð½Ð½Ñ‹Ð¹ __builtins__, Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº re, json, datetime, schedule, safe_requests.[^1]
- Ð¥ÑƒÐºÐ¸: pre_create, post_create, pre_modify, post_modify, pre_delete, post_delete, validation, scheduler, export_format.[^1]

ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ execute_hook:

- Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° (ldap Ñ‡ÐµÑ€ÐµÐ· PluginLDAPWrapper, db Ñ‡ÐµÑ€ÐµÐ· PluginDBWrapper).[^1]
- ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð²ÑÐµ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡ÐµÐ¹ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ data Ð¸ context, Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¼ÑƒÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ data.[^1]
- Ð—Ð°Ñ‚ÐµÐ¼ Ð²Ð¾Ð·Ð¼Ð¾Ð¶ÐµÐ½ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ WorkflowEngine.trigger_event Ð´Ð»Ñ mapping ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ðº workflow: post_create, post_modify, user_disabled.[^1]


### 21. Simple Plugin: Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹

- ÐŸÑ€Ð¸Ð¼ÐµÑ€ registration:
    - get_metadata â†’ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ name, version, description.[^1]
    - register_hooks(manager) â†’ manager.register_hook("post_create", handler).[^1]
- ÐŸÑ€Ð¸Ð¼ÐµÑ€ handler:
    - context['db'].log_event("PLUGIN_ACTION", "message", meta) â†’ Ð¿Ð¸ÑˆÐµÑ‚ Ð² AuditRecord Ñ‡ÐµÑ€ÐµÐ· Ð¾Ð±ÐµÑ€Ñ‚ÐºÑƒ.[^1]
    - context['ldap'].add_to_group(user_dn, group_dn) â†’ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ.[^1]
    - safe_requests.post(url, json=...) â†’ HTTP Ñ Ð±ÐµÐ»Ñ‹Ð¼ ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ Ñ…Ð¾ÑÑ‚Ð¾Ð² SafeRequests.ALLOWED_HOSTS.[^1]


### 22. Advanced Plugin Development

- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…: Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð² validation Ñ…ÑƒÐºÐµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð±Ð¾Ñ€Ð²Ð°Ñ‚ÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ð´Ð¾ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð² AD.[^1]
- ÐÐ´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð´ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚: Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ export_format Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, PDF) Ð¸ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ pdf_content Ð¸ content_type â†’ backend Ð¾Ñ‚Ð´Ð°ÑÑ‚ StreamingResponse.[^1]
- ÐšÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚ Ð¿Ð¾ mutability: pre_* Ñ…ÑƒÐºÐ¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¼ÐµÐ½ÑÑ‚ÑŒ data (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¤Ð˜Ðž, Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ UPN), post_* â€” Ð´Ð»Ñ side-effects (ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ, Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸).[^1]


### 23. Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ñ… Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð² (Ð¸Ð´ÐµÐ¸)

- AutoDepartmentGroup: post_create/post_modify â†’ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ Ð¿Ð¾ department.[^1]
- HR Sync: post_create â†’ safe_requests.post Ð² HR/CRM.[^1]
- Export PDF: export_format â†’ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ PDF, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ pdf_content Ð¸ content_type.[^1]
- License Counter: post_create/post_delete â†’ Ð²ÐµÐ´ÐµÑ‚ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº Ð² Ð‘Ð” (Ñ‡ÐµÑ€ÐµÐ· PluginDBWrapper.log_event Ñ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸).[^1]


### 24. Testing Ð¸ Debugging Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð²

- Ð—Ð°Ð¿ÑƒÑÐº Ð² DEV: PLUGIN_DEBUG=true (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ); Ð»Ð¾Ð³Ð¸ Ð² ad_system.log (JSON) + stdout.[^1]
- Ð¢Ð¸Ð¿Ð¾Ð²Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸: Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹, Ð²Ñ‹Ñ…Ð¾Ð´ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‹ allowed hosts Ð² SafeRequests.[^1]

***

## Ð§ÐÐ¡Ð¢Ð¬ VI: Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð˜

### 25. REST API Reference (ÐºÑ€Ð°Ñ‚ÐºÐ¾)

- Auth:
    - POST /api/v6/token â†’ OAuth2PasswordRequestForm (username, password) â†’ JWT, role.[^1]
- Users:
    - GET /api/v6/ad/users?query=\&filter_type=\&page=\&page_size= â†’ ÑÐ¿Ð¸ÑÐ¾Ðº, Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ.[^1]
    - POST /api/v6/ad/users/create â†’ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ (admin), password unicodePwd, uac.[^1]
    - POST /api/v6/ad/users/toggle â†’ bulk enable/disable (admin) + backup.[^1]
    - GET /api/v6/ad/users/export?query=\&filter_type=\&format= â†’ CSV/XLSX/ÐºÐ°ÑÑ‚Ð¾Ð¼ Ñ‡ÐµÑ€ÐµÐ· export_format.[^1]
- Mass Update:
    - POST /api/v6/mass-update-exec/ â†’ items[{identifier, fields{...}}] + backup; Ð»Ð¾Ð³ Ð¸ updated.[^1]
- Groups/Computers:
    - GET /api/v6/ad/groups â†’ name, members count, dn.[^1]
    - POST /api/v6/ad/groups/create â†’ admin, conn.add group.[^1]
    - GET /api/v6/ad/computers â†’ name, os, lastLogon.[^1]
    - POST /api/v6/ad/computers/{dn}/disable â†’ UAC 4098.[^1]
- Reports:
    - GET /api/v6/reports/disabled-users â†’ UAC bit 2.[^1]
    - GET /api/v6/reports/inactive-users?days=90 â†’ lastLogonTimestamp cutoff.[^1]
- Search:
    - GET /api/v6/ad/search?q=\&limit= â†’ users+groups mixed.[^1]
- Workflows:
    - GET /api/v6/workflows â†’ ids.[^1]
    - GET /api/v6/workflows/{id} â†’ JSON.[^1]
    - POST /api/v6/workflows â†’ save JSON + reload cache.[^1]
    - POST /api/v6/workflows/{id}/execute â†’ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº (thread).[^1]
- Config/Health:
    - GET /api/v6/config â†’ default_ou, dashboard_config.[^1]
    - POST /api/v6/config/dashboard â†’ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð¾Ð².[^1]
    - GET /health, /health/ldap, /health/db â†’ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹.[^1]
    - GET /metrics â†’ Prometheus text format counters.[^1]
- Audit/Backups:
    - GET /api/v6/audit-logs?limit= â†’ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸.[^1]
    - GET /api/v6/backups â†’ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ„Ð°Ð¹Ð»Ð¾Ð².[^1]
    - GET /api/v6/backups/{filename} â†’ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ JSON.[^1]
- Self-service:
    - POST /api/v6/self/password â†’ ÑÐ¼ÐµÐ½Ð° Ð¿Ð°Ñ€Ð¾Ð»Ñ Ñ‡ÐµÑ€ÐµÐ· extend.microsoft.modify_password.[^1]


### 26. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ 1Ð¡

- Ð§ÐµÑ€ÐµÐ· workflow Ð¸Ð»Ð¸ post_create hook Ð¿Ð»Ð°Ð³Ð¸Ð½Ð°: safe_requests.post("https://1c.company.local/sync", json=data), Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ñ‚Ð²ÐµÑ‚Ð°, Ð»Ð¾Ð³ Ñ‡ÐµÑ€ÐµÐ· context['db'].[^1]
- Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ: whitelist 1Ð¡ Ñ…Ð¾ÑÑ‚ Ð² SafeRequests.ALLOWED_HOSTS.[^1]


### 27. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ CRM/HRM/ITSM

- Webhook ÑˆÐ°Ð³ Ð² workflow: SafeRequests.post(url, json=context) Ñ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð¼; Ñ€ÐµÑ‚Ñ€Ð°Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¸Ð»Ð¸ Ð² scheduler Ð¿Ð»Ð°Ð³Ð¸Ð½Ð°.[^1]


### 28. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ SIEM

- JSON-Ð»Ð¾Ð³Ð¸ ad_system.log (RotatingFileHandler + JSONFormatter) Ð´Ð»Ñ ingestion Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð¼ (Splunk/ELK).[^1]
- ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð°: Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ audit Ñ‡ÐµÑ€ÐµÐ· /api/v6/audit-logs.[^1]


### 29. PowerShell Module (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ)

- Ð’ Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°: Ð¿Ñ€Ð¸Ð¼ÐµÑ€ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Ñ Invoke-RestMethod Ð´Ð»Ñ Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ (Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² docs/scripts). Ð‘ÑÐºÐµÐ½Ð´ ÑƒÐ¶Ðµ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ REST endpoints.[^1]

***

## Ð§ÐÐ¡Ð¢Ð¬ VII: Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬

### 30. Security Architecture

- Auth: JWT HS256 Ñ exp=60m, OAuth2 token endpoint.[^1]
- RBAC: Ñ€Ð¾Ð»ÑŒ admin Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ÑÑ Ð¿Ð¾ Ñ‡Ð»ÐµÐ½ÑÑ‚Ð²Ñƒ Domain Admins (memberOf ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°).[^1]
- Rate Limiting: SlowAPI â€” 5/min login, 10/min create, 3/min mass update, 10/min toggle.[^1]
- LDAP Pool: threading.Condition, timeout 30s, max connections 10, auto_bind NTLM, auto-reconnect.[^1]
- Plugin Sandbox: Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ðµ builtins, SafeRequests whitelist, LDAP/DB wrappers.[^1]
- XSS Ð·Ð°Ñ‰Ð¸Ñ‚Ð°: Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ escapeHtml() Ð½Ð° Ñ„Ñ€Ð¾Ð½Ñ‚Ðµ Ð²ÐµÐ·Ð´Ðµ Ð¿Ñ€Ð¸ Ð²ÑÑ‚Ð°Ð²ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ… â€” Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑ‚ÑŒÑÑ (ÑÐ¼. Ñ‡ÐµÐºÐ»Ð¸ÑÑ‚).[^2]


### 31. Threat Model Ð¸ Ð—Ð°Ñ‰Ð¸Ñ‚Ð°

- LDAP Injection: Ð²ÐµÐ·Ð´Ðµ escape_filter_chars, OU whitelist exact match, Ð·Ð°Ð¿Ñ€ÐµÑ‚ startswith-Ð»Ð¾Ð³Ð¸ÐºÐ¸.[^1]
- XSS: ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² users/groups/computers/reports/search/import-log (Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð·Ð¾Ð² escapeHtml() Ð² HTML), Ð·Ð°Ð¿Ñ€ÐµÑ‚ html() Ð±ÐµÐ· ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.[^2]
- DoS: rate limits, LDAP pool Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸ÐµÐ¼ Ð¸ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð¼.[^1]
- Supply Chain: Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð², Ð·Ð°Ð¿Ñ€ÐµÑ‚ Ð¾Ð¿Ð°ÑÐ½Ñ‹Ñ… Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð², safe_requests.[^1]
- Secrets: JWT_SECRET_KEY Ð¸Ð· env, Ð¿Ð°Ñ€Ð¾Ð»Ð¸ Ð½Ðµ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ (log_audit Ð½Ðµ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ password).[^1]


### 32. Compliance (GDPR/SOX/ISO)

- Audit trail: ÐºÑ‚Ð¾/Ñ‡Ñ‚Ð¾/ÐºÐ¾Ð³Ð´Ð°/Ð¾Ñ‚ÐºÑƒÐ´Ð°/IP/ÑÑ‚Ð°Ñ‚ÑƒÑ â€” AuditRecord, JSON logging.[^1]
- Data retention: backups JSON Ð¸ audit logs â€” Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ 90â€“180 Ð´Ð½ÐµÐ¹).[^1]
- Right to audit: GET /api/v6/audit-logs, Ð²Ñ‹Ð³Ñ€ÑƒÐ·ÐºÐ° CSV/JSON Ñ‡ÐµÑ€ÐµÐ· API.[^1]


### 33. Penetration Testing Results (ÑˆÐ°Ð±Ð»Ð¾Ð½)

- LDAP injection: Ð½Ðµ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÑÑ (escape_filter_chars).[^1]
- XSS: ÑƒÑÑ‚Ñ€Ð°Ð½ÐµÐ½ Ð¿Ñ€Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ escapeHtml Ð½Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚Ðµ.[^2]
- RCE Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»Ð°Ð³Ð¸Ð½Ñ‹: Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ÑÑ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼ ÐºÐ¾Ð´Ð° Ð¸ sandbox'Ð¾Ð¼.[^1]
- Auth brute-force: rate limit 5/min Ð½Ð° /token.[^1]


### 34. Security Hardening Checklist

- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ HTTPS (nginx reverse proxy) Ð¸ LDAPS.[^1]
- Ð—Ð°Ð´Ð°Ñ‚ÑŒ ÑÐ¸Ð»ÑŒÐ½Ñ‹Ð¹ JWT_SECRET_KEY (â‰¥32 bytes), Ñ Ñ€Ð¾Ñ‚Ð°Ñ†Ð¸ÐµÐ¹.[^1]
- ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº /api/v6/token Ð¿Ð¾ IP (nginx).[^1]
- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ JSON_LOGGING, Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ±Ð¾Ñ€ Ð»Ð¾Ð³Ð¾Ð².[^1]
- ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ñ‚ÑŒ SafeRequests.ALLOWED_HOSTS Ð¿Ð¾Ð´ ÑÐ²Ð¾Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº.[^1]
- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ALLOWED_OUS Ð² .env (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð¾Ð²ÐµÑ€ÐµÐ½Ð½Ñ‹Ðµ).[^1]
- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ PostgreSQL Ð²Ð¼ÐµÑÑ‚Ð¾ SQLite Ð´Ð»Ñ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸.[^1]

***

## Ð§ÐÐ¡Ð¢Ð¬ VIII: Ð­ÐšÐ¡ÐŸÐ›Ð£ÐÐ¢ÐÐ¦Ð˜Ð¯

### 35. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¸ ÐÐ»ÐµÑ€Ñ‚Ð¸Ð½Ð³

- /metrics: counters ad_requests_total, ad_errors_total, ad_latency_seconds_sum Ð´Ð»Ñ Prometheus (text format).[^1]
- /health, /health/ldap, /health/db â€” Ð´Ð»Ñ blackbox checks.[^1]
- Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð°Ð»ÐµÑ€Ñ‚Ñ‹: Ñ€Ð¾ÑÑ‚ errors_total, Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ /health/ldap, ÑÐºÐ°Ñ‡ÐºÐ¸ latency_sum, 429 Ð²ÑÐ¿Ð»ÐµÑÐºÐ¸ Ð½Ð° /token.[^1]


### 36. Performance Tuning

- Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ LDAP_POOL_SIZE Ð¿Ñ€Ð¸ Ñ€Ð¾ÑÑ‚Ðµ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»Ð¸Ð·Ð¼Ð° (env).[^1]
- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ StatsCache Ð½Ð° /stats (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ð¾ Ðº Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ â€” 5 Ð¼Ð¸Ð½ÑƒÑ‚).[^1]
- Ð’Ñ‹Ð½ÐµÑÑ‚Ð¸ Ð‘Ð” Ð½Ð° PostgreSQL, Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ audit_logs Ð¿Ð¾ timestamp Ð¸ user.[^1]
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Gunicorn c UvicornWorker, 2Ã—CPU workers.[^1]


### 37. Backup Strategy

- Ð‘ÑÐºÐ°Ð¿Ñ‹ ÑÐ¾Ð·Ð´Ð°ÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ JSON-Ñ„Ð°Ð¹Ð»Ð°Ð¼Ð¸ Ð¿ÐµÑ€ÐµÐ´ Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ð¼Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¸ bulk toggle.[^1]
- Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:
    - Ð ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð° backups/ Ð½Ð° NAS/S3.
    - ÐŸÐ¾Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ñ€Ð¾Ñ‚Ð°Ñ†Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 90 Ð´Ð½ÐµÐ¹).
    - Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±ÑÐºÐ°Ð¿Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· /api/v6/backups.[^1]


### 38. Disaster Recovery

- ÐŸÑ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ backup_mass_update_*.json Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð² Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ (ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ â€” Ð² Roadmap v7.2 UI Restore).[^1]
- Ð”Ð»Ñ Ð¿Ð¾Ñ‚ÐµÑ€Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð°: Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€, ÑÐ¼Ð¾Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ backups/ Ð¸ Ð‘Ð”, secrets Ð¸Ð· .env.[^1]


### 39. ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ð²ÐµÑ€ÑÐ¸ÑÐ¼Ð¸

- v6.3 â†’ v7.1:
    - ÐÑƒÐ¶Ð½Ð° Ð°Ð´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð² (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ wrappers Ð¸ safe_requests).[^1]
    - ÐŸÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ .env (JWT_SECRET_KEY).[^1]
    - ÐŸÐµÑ€ÐµÐ½Ð¾Ñ backups/ Ð¸ audit.db/postgres.[^1]
- Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð³Ð¾Ð½ Ð² DEV, Ð·Ð°Ñ‚ÐµÐ¼ PROD Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¼ Ð¾ÐºÐ½Ð¾Ð¼.[^1]

***

## Ð§ÐÐ¡Ð¢Ð¬ IX: TROUBLESHOOTING

### 40. Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

- Ð›Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ: ad_system.log (JSON) + stdout, Ñ€Ð¾Ñ‚Ð°Ñ†Ð¸Ñ 10MBÃ—5.[^1]
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° LDAP: /health/ldap (503 Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ).[^1]
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° DB: /health/db.[^1]
- Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° rate limits: HTTP 429, ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ nginx Ð¸ app logs.[^1]


### 41. Ð Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸

- 401 Ð½Ð° /token: Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ credentials Ð¸Ð»Ð¸ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ð°Ñ ÑƒÑ‡ÐµÑ‚Ð½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° UAC).[^1]
- 403 Ð½Ð° admin endpoints: Ð½ÐµÑ‚ Ñ€Ð¾Ð»Ð¸ admin (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° memberOf).[^1]
- 503 Pool Exhausted: Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ LDAP ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ â€” ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ max Ð¸Ð»Ð¸ Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒÑÑ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ.[^1]
- ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð²: Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¸Ð»Ð¸ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ñ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÐµÐ¼ Ñ…ÑƒÐºÐ°.[^1]


### 42. Log Analysis

- JSONFormatter: Ð¿Ð¾Ð»Ñ timestamp, level, logger, message (Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ user/ip Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸).[^1]
- ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² Ð² Splunk/ELK: Ð¿Ð¾ action, status, user Ð´Ð»Ñ Ð²Ñ‹Ñ‡Ð»ÐµÐ½ÐµÐ½Ð¸Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹.[^1]


### 43. Support Escalation

- Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ: ad_system.log, Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ backups, Ð²ÐµÑ€ÑÐ¸Ñ main.py Ð¸ index.html, .env (Ð±ÐµÐ· ÑÐµÐºÑ€ÐµÑ‚Ð¾Ð²), ÑÐ¿Ð¸ÑÐ¾Ðº ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð².[^1]

***

# ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð¯

## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ A: ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° .env (Ð¾Ð±Ñ€Ð°Ð·ÐµÑ†)

- ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ: AD_SERVER, AD_DOMAIN, AD_BASE_DN, AD_SYSTEM_USER, AD_SYSTEM_PASSWORD, JWT_SECRET_KEY.[^1]
- ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ: DATABASE_URL, LDAP_POOL_SIZE, RATE_LIMIT_STORAGE, ALLOWED_OUS, PROMETHEUS_ENABLED, JSON_LOGGING.[^1]


## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ B: API Reference (Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾)

- Ð¡Ð¼. Ñ€Ð°Ð·Ð´ÐµÐ» 25 â€” Ð²ÑÐµ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹ Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð°Ð¼Ð¸ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ñ‹ Ð¿Ð¾ ÐºÐ¾Ð´Ñƒ.[^1]


## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ C: Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° ÐŸÐ»Ð°Ð³Ð¸Ð½Ð¾Ð²

- Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¸ ÐºÐ°Ñ€ÐºÐ°ÑÑ‹ Ð¿Ð¾Ð´ AutoDepartmentGroup, HR Sync, Export PDF â€” Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· wrappers/safe_requests.[^1]


## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ D: SQL Schema

- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹ audit_logs (id, timestamp, user, action, target, details, ip_address, status), user_settings (username, dashboard_config).[^1]


## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ E: Network Diagram

- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ñ‹ Ð² Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ðµ: Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€â†’nginxâ†’FastAPIâ†’AD/DB; Ð²Ð½ÐµÑˆÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸ Ñ‡ÐµÑ€ÐµÐ· SafeRequests.[^1]


## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ F: Comparison Matrix

- Ð’ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ð¸ Ñ ManageEngine/SolarWinds/Quest: Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð¾ Ð² Ð¿Ð»Ð°Ð³Ð¸Ð½Ð°Ñ…, rollback, REST API, ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸; ÑƒÑÑ‚ÑƒÐ¿ÐºÐ° â€” Ð½ÐµÑ‚ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ð° workflow (roadmap v7.2).[^1]


## ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ G: Ð“Ð»Ð¾ÑÑÐ°Ñ€Ð¸Ð¹

- UAC, DN, OU, RBAC, LDAPS, NTLM, Hook, Workflow, SafeRequests, Plugin Sandbox, Rollback, Backup Snapshot, Prometheus Metrics.[^1]

***

# Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ðº v7.1 (Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÑ€ÑƒÐ³)

- ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ escapeHtml() Ð²Ð¾ Ð²ÑÐµÑ… HTML Ð²ÑÑ‚Ð°Ð²ÐºÐ°Ñ…: users, groups, computers, reports, search results, import log.[^2]
- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ StatsCache (TTL 300s) Ðº /api/v6/stats (Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ð° AD ÑÐ½Ð¸Ð·Ð¸Ñ‚ÑÑ).[^1]
- Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð² docs/ Ð¸ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð² PDF/HTML; Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ð² draw.io/mermaid.[^1]

ÐŸÐ¾ÑÐ»Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÑ‚Ð¸Ñ… Ð´Ð²ÑƒÑ… Ð¼ÐµÐ»ÐºÐ¸Ñ… ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ Ð´Ð¾ÑÑ‚Ð¸Ð³Ð°ÑŽÑ‚ ÑƒÑ€Ð¾Ð²Ð½Ñ 100/100 Ð¿Ð¾ production-readiness.

<div align="center">â‚</div>

[^1]: main.py

[^2]: index.html
