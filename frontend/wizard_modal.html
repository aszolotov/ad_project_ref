<!-- USER CREATION WIZARD MODAL -->
<div class="modal fade" id="user-wizard-modal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 pb-0">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-user-plus me-2 text-primary"></i>
                    Создание пользователя
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="closeUserWizard()"></button>
            </div>

            <!-- Progress Steps -->
            <div class="px-4 pt-3 pb-0">
                <div class="wizard-progress">
                    <div class="wizard-step" data-step="1">
                        <div class="wizard-step-circle active">
                            <i class="fas fa-th-large"></i>
                        </div>
                        <div class="wizard-step-label">Шаблон</div>
                    </div>
                    <div class="wizard-step-line"></div>
                    <div class="wizard-step" data-step="2">
                        <div class="wizard-step-circle">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="wizard-step-label">Основное</div>
                    </div>
                    <div class="wizard-step-line"></div>
                    <div class="wizard-step" data-step="3">
                        <div class="wizard-step-circle">
                            <i class="fas fa-address-card"></i>
                        </div>
                        <div class="wizard-step-label">Контакты</div>
                    </div>
                    <div class="wizard-step-line"></div>
                    <div class="wizard-step" data-step="4">
                        <div class="wizard-step-circle">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="wizard-step-label">Группы</div>
                    </div>
                    <div class="wizard-step-line"></div>
                    <div class="wizard-step" data-step="5">
                        <div class="wizard-step-circle">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="wizard-step-label">Проверка</div>
                    </div>
                </div>
            </div>

            <div class="modal-body">
                <!-- Step 1: Template Selection -->
                <div id="wizard-step-1" class="wizard-content active">
                    <h5 class="mb-4">Выберите шаблон или начните с нуля</h5>
                    <div id="templates-grid" class="row g-3">
                        <!-- Templates loaded here -->
                    </div>
                </div>

                <!-- Step 2: Basic Info -->
                <div id="wizard-step-2" class="wizard-content d-none">
                    <h5 class="mb-4">Основная информация</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Имя <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="wiz-givenName" required>
                            <div class="form-text">Имя пользователя (например: Иван)</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Фамилия <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="wiz-sn" required>
                            <div class="form-text">Фамилия (например: Иванов)</div>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">
                                Логин (sAMAccountName) <span class="text-danger">*</span>
                                <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip"
                                    title="3-20 символов, только латиница и цифры"></i>
                            </label>
                            <input type="text" class="form-control" id="wiz-sAMAccountName" required>
                            <div class="form-text">Будет сгенерирован автоматически из имени и фамилии</div>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Пароль <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="wiz-password" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="generatePassword()">
                                    <i class="fas fa-random"></i> Сгенерировать
                                </button>
                            </div>
                            <div class="form-text">Минимум 8 символов, включая заглавные буквы и цифры</div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Contact & Organization -->
                <div id="wizard-step-3" class="wizard-content d-none">
                    <h5 class="mb-4">Контакты и организация</h5>
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="wiz-mail">
                            <div class="form-text">Будет создан почтовый ящик</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Телефон</label>
                            <input type="text" class="form-control" id="wiz-telephoneNumber"
                                placeholder="+7 (999) 123-45-67">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Мобильный</label>
                            <input type="text" class="form-control" id="wiz-mobile" placeholder="+7 (999) 123-45-67">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Отдел</label>
                            <input type="text" class="form-control" id="wiz-department"
                                placeholder="IT, Sales, Marketing...">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Должность</label>
                            <input type="text" class="form-control" id="wiz-title"
                                placeholder="Software Engineer, Manager...">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Компания</label>
                            <input type="text" class="form-control" id="wiz-company" value="VibeCode">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Офис</label>
                            <input type="text" class="form-control" id="wiz-office"
                                placeholder="Moscow Office, Remote...">
                        </div>
                    </div>
                </div>

                <!-- Step 4: Groups Selection -->
                <div id="wizard-step-4" class="wizard-content d-none">
                    <h5 class="mb-4">Группы и права доступа</h5>
                    <div class="mb-3">
                        <label class="form-label">Поиск групп:</label>
                        <input type="text" class="form-control" id="wiz-group-search"
                            placeholder="Начните вводить название группы...">
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h6>Выбранные группы:</h6>
                            <div id="wiz-selected-groups" class="d-flex flex-wrap gap-2 mb-3">
                                <!-- Selected groups badges here -->
                            </div>
                        </div>
                    </div>
                    <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                        <h6>Доступные группы:</h6>
                        <div id="wiz-groups-list">
                            <!-- Groups list loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Step 5: Review & Confirm -->
                <div id="wizard-step-5" class="wizard-content d-none">
                    <h5 class="mb-4">Проверка данных</h5>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Проверьте введённые данные перед созданием пользователя
                    </div>
                    <table class="table table-bordered">
                        <tbody id="wiz-review-table">
                            <!-- Review data here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-light border" id="wiz-btn-prev" onclick="prevWizardStep()">
                    <i class="fas fa-chevron-left me-2"></i> Назад
                </button>
                <button type="button" class="btn btn-light border" data-bs-dismiss="modal" onclick="closeUserWizard()">
                    Отмена
                </button>
                <button type="button" class="btn btn-primary px-4" id="wiz-btn-next" onclick="nextWizardStep()">
                    Далее <i class="fas fa-chevron-right ms-2"></i>
                </button>
                <button type="button" class="btn btn-success px-4 d-none" id="wiz-btn-create"
                    onclick="createUserFromWizard()">
                    <i class="fas fa-check me-2"></i> Создать пользователя
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Progress Modal -->
<div id="progress-modal" class="modal fade" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;"></div>
                <h5 id="progress-message">Обработка...</h5>
                <div class="progress mt-3" style="height: 25px;">
                    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated"
                        style="width: 0%">
                        <span id="progress-percent">0%</span>
                    </div>
                </div>
                <small class="text-muted mt-2 d-block" id="progress-detail"></small>
            </div>
        </div>
    </div>
</div>